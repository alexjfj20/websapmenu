(function(){"use strict";var e={133:function(e,o,n){n.r(o);const a="/api";let r=localStorage.getItem("token")||"";const t=e=>{r=e,e?localStorage.setItem("token",e):localStorage.removeItem("token")},s=async(e,o={})=>{try{const n={"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`},...o.headers||{}},t=await fetch(`${a}${e}`,{method:"GET",headers:n,...o});if("blob"===o.responseType)return t.blob();const s=t.headers.get("content-type");if(!s||!s.includes("application/json")){const e=await t.text();return{success:t.ok,data:e,status:t.status}}const i=await t.json();if(401!==t.status&&403!==t.status||console.warn(`Error de autenticaci√≥n en ${e}:`,i),!t.ok)throw new Error(i.message||"Error en la petici√≥n");return i}catch(n){throw console.error(`Error en GET ${e}:`,n),n}},i=async(e,o={},n={})=>{try{const t={"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`},...n.headers||{}},s=await fetch(`${a}${e}`,{method:"POST",headers:t,body:JSON.stringify(o),...n}),i=await s.json();if(!s.ok)throw new Error(i.message||"Error en la petici√≥n");return i}catch(t){throw console.error(`Error en POST ${e}:`,t),t}},c=async(e,o={},n={})=>{try{const t={"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`},...n.headers||{}},s=await fetch(`${a}${e}`,{method:"PUT",headers:t,body:JSON.stringify(o),...n}),i=await s.json();if(!s.ok)throw new Error(i.message||"Error en la petici√≥n");return i}catch(t){throw console.error(`Error en PUT ${e}:`,t),t}},l=async(e,o={})=>{try{const n={"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`},...o.headers||{}},t=await fetch(`${a}${e}`,{method:"DELETE",headers:n,...o}),s=await t.json();if(!t.ok)throw new Error(s.message||"Error en la petici√≥n");return s}catch(n){throw console.error(`Error en DELETE ${e}:`,n),n}};o["default"]={setToken:t,get:s,post:i,put:c,delete:l}},532:function(e,o,n){e.exports=n.p+"img/sun.ef46db37.svg"},981:function(e,o,n){n.d(o,{HW:function(){return m},eF:function(){return i},hf:function(){return p},iD:function(){return l},ri:function(){return d},wR:function(){return u}});n(4979);var a=n(4373);const r="https://websapmenu.onrender.com/api",t=e=>{localStorage.setItem("token",e)},s=()=>localStorage.getItem("token"),i=()=>{localStorage.removeItem("token")},c=()=>{a.A.interceptors.request.use((e=>{const o=s();return o&&(e.headers.Authorization=`Bearer ${o}`),e}),(e=>Promise.reject(e))),a.A.interceptors.response.use((e=>e),(e=>(e.response&&401===e.response.status&&(i(),"/login"!==window.location.pathname&&(window.location.href="/login")),Promise.reject(e))))};async function l(e,o){console.log("Intentando iniciar sesi√≥n con:",e);try{i(),localStorage.removeItem("user"),localStorage.removeItem("isLoggedIn"),console.log("Enviando solicitud al backend:",`${r}/auth/login`);const s=await a.A.post(`${r}/auth/login`,{email:e,password:o},{headers:{"Content-Type":"application/json"},withCredentials:!1,timeout:1e4});if(console.log("Respuesta del backend:",s.status,s.data),200===s.status&&s.data.success){console.log("Login exitoso con el backend");const e=s.data.data.token;return t(e),Promise.resolve().then(n.bind(n,133)).then((o=>{console.log("Actualizando token en apiService"),o.default.setToken(e)})),localStorage.setItem("user",JSON.stringify(s.data.data.user)),localStorage.setItem("isLoggedIn","true"),{success:!0,user:s.data.data.user}}throw console.error("Respuesta inesperada del servidor:",s.data),new Error("Respuesta inesperada del servidor")}catch(s){if(s.response){if(console.error("Error de respuesta del servidor:",s.response.status,s.response.data),s.response.data&&s.response.data.message&&s.response.data.message.includes("desactivado"))throw new Error(s.response.data.message)}else s.request?console.error("No se recibi√≥ respuesta del servidor:",s.request):console.error("Error al configurar la solicitud:",s.message);console.log("Fallback a autenticaci√≥n local...");const a=[{id:1,email:"superadmin@example.com",password:"123456",nombre:"Super Administrador",roles:["Superadministrador"]},{id:2,email:"admin@example.com",password:"123456",nombre:"Administrador",roles:["Administrador"]},{id:3,email:"empleado@example.com",password:"123456",nombre:"Empleado",roles:["Empleado"]},{id:5,email:"alex@gmail.com",password:"password",nombre:"alex",roles:["Empleado"]}],r=a.find((n=>n.email===e&&n.password===o));if(r){console.log("Login exitoso con usuario local:",r.email),localStorage.setItem("isLoggedIn","true");const e=`local_${btoa(JSON.stringify(r))}`;return t(e),Promise.resolve().then(n.bind(n,133)).then((o=>{console.log("Actualizando token en apiService (local)"),o.default.setToken(e)})),localStorage.setItem("user",JSON.stringify({id:r.id,email:r.email,nombre:r.nombre,roles:r.roles})),{success:!0,user:{id:r.id,email:r.email,nombre:r.nombre,roles:r.roles}}}throw new Error("Credenciales incorrectas")}}c();const d=()=>{i(),localStorage.removeItem("user"),localStorage.removeItem("isLoggedIn")},u=()=>{const e=s(),o="true"===localStorage.getItem("isLoggedIn");return!!e&&o},m=()=>{try{const e=localStorage.getItem("user");if(!e)return console.log("No hay usuario en localStorage"),null;const o=JSON.parse(e);return console.log("Usuario actual obtenido de localStorage:",o.email),o}catch(e){return console.error("Error al obtener el usuario actual:",e),null}},p=e=>{const o=m();return o&&o.roles&&o.roles.includes(e)}},4216:function(e,o,n){n.d(o,{Dh:function(){return l},Ds:function(){return k},Fk:function(){return d},Hk:function(){return p},LX:function(){return E},VI:function(){return v},rM:function(){return u},vh:function(){return g}});n(8111),n(2489),n(116);const a="restauranteAppDB",r=4,t="platos",s="syncQueue",i=()=>new Promise(((e,o)=>{console.log(`Intentando abrir la base de datos con versi√≥n: ${r}`);const n=indexedDB.open(a,r);n.onerror=e=>{console.error("Error al abrir la base de datos IndexedDB:",e),o("Error al abrir la base de datos")},n.onsuccess=o=>{const n=o.target.result;console.log("IndexedDB inicializada correctamente"),e(n)},n.onupgradeneeded=e=>{const o=e.target.result;if(console.log("Actualizando estructura de la base de datos..."),o.objectStoreNames.contains(t)){console.log("El almac√©n de platos ya existe");try{o.deleteObjectStore(t),console.log("Almac√©n de platos eliminado para recreaci√≥n");const e=o.createObjectStore(t,{keyPath:"id"});e.createIndex("name","name",{unique:!1}),e.createIndex("syncStatus","syncStatus",{unique:!1}),console.log("Almac√©n de platos recreado con nueva configuraci√≥n")}catch(n){console.error("Error al intentar modificar el almac√©n de platos:",n)}}else{console.log("Creando almac√©n de platos...");const e=o.createObjectStore(t,{keyPath:"id"});e.createIndex("name","name",{unique:!1}),e.createIndex("syncStatus","syncStatus",{unique:!1}),console.log("Almac√©n de platos creado")}if(o.objectStoreNames.contains(s))console.log("El almac√©n de cola de sincronizaci√≥n ya existe");else{console.log("Creando almac√©n de cola de sincronizaci√≥n...");const e=o.createObjectStore(s,{keyPath:"id",autoIncrement:!0});e.createIndex("timestamp","timestamp",{unique:!1}),e.createIndex("type","type",{unique:!1}),console.log("Almac√©n de cola de sincronizaci√≥n creado")}}})),c=async()=>{try{return await i()}catch(e){throw console.error("Error al abrir conexi√≥n a IndexedDB:",e),e}},l=async()=>{try{console.log("Obteniendo todos los platos de IndexedDB...");const e=await c();return new Promise(((o,n)=>{const a=e.transaction([t],"readonly"),r=a.objectStore(t),s=r.getAll();s.onsuccess=e=>{const n=e.target.result;console.log(`Obtenidos ${n.length} platos totales de IndexedDB`);const a=n.filter((e=>!e.deleted));console.log(`Filtrando platos eliminados: ${n.length-a.length} platos ocultos, ${a.length} platos activos`),o(a)},s.onerror=e=>{console.error("Error al obtener platos de IndexedDB:",e),n("Error al obtener platos localmente")}}))}catch(e){throw console.error("Error en getAllPlatos:",e),e}},d=async()=>{try{console.log("Buscando platos pendientes de sincronizaci√≥n...");const e=await c();return new Promise(((o,n)=>{const a=e.transaction([t],"readonly"),r=a.objectStore(t),s=r.index("syncStatus"),i=s.getAll("pending");i.onsuccess=e=>{const n=e.target.result;console.log(`Encontrados ${n.length} platos pendientes de sincronizaci√≥n`),o(n)},i.onerror=e=>{console.error("Error al obtener platos pendientes:",e),n("Error al obtener platos pendientes")}}))}catch(e){throw console.error("Error en getPendingPlatos:",e),e}},u=async(e,o)=>{console.log(`Actualizando estado de sincronizaci√≥n del plato ID ${e} a "${o}"...`);let n=o;"boolean"===typeof o&&(n=!0===o?"synced":"pending",console.log(`Convertido estado booleano ${o} a "${n}"`));const s=["pending","synced","pending_deletion"];if(!s.includes(n))throw new Error(`Estado inv√°lido: ${o}. Debe ser uno de: ${s.join(", ")}`);return new Promise(((o,s)=>{const i=indexedDB.open(a,r);i.onerror=e=>{console.error("Error al abrir la base de datos:",e.target.error),s(new Error("No se pudo abrir la base de datos para actualizar el estado."))},i.onsuccess=a=>{const r=a.target.result;try{const a=r.transaction([t],"readwrite"),i=a.objectStore(t),c=i.get(e);c.onerror=o=>{console.error(`Error al obtener plato ID ${e}:`,o.target.error),s(new Error(`No se pudo obtener el plato ID ${e}.`))},c.onsuccess=a=>{const r=a.target.result;if(!r)return console.error(`No se encontr√≥ plato con ID ${e}.`),void s(new Error(`No se encontr√≥ plato con ID ${e}.`));r.syncStatus=n,"pending_deletion"===n&&(r.is_available=!1);const t=i.put(r);t.onerror=o=>{console.error(`Error al actualizar plato ID ${e}:`,o.target.error),s(new Error(`No se pudo actualizar el estado del plato ID ${e}.`))},t.onsuccess=()=>{console.log(`Estado de sincronizaci√≥n del plato ID ${e} actualizado a "${n}".`),o(!0)}},a.oncomplete=()=>{r.close()}}catch(i){console.error("Error en la transacci√≥n:",i),s(i)}}}))},m=async e=>{try{console.log("Agregando elemento a la cola de sincronizaci√≥n:",e);const o=await c();return new Promise(((n,a)=>{const r=o.transaction([s],"readwrite"),t=r.objectStore(s),i=t.add(e);i.onsuccess=e=>{console.log("Elemento agregado a la cola de sincronizaci√≥n"),n(e.target.result)},i.onerror=e=>{console.error("Error al agregar a la cola de sincronizaci√≥n:",e),a("Error al agregar a la cola de sincronizaci√≥n")}}))}catch(o){throw console.error("Error en addToSyncQueue:",o),o}},p=async()=>{try{console.log("Obteniendo cola de sincronizaci√≥n...");const e=await c();return new Promise(((o,n)=>{const a=e.transaction([s],"readonly"),r=a.objectStore(s),t=r.getAll();t.onsuccess=e=>{const n=e.target.result;console.log(`Obtenidos ${n.length} elementos de la cola de sincronizaci√≥n`),o(n)},t.onerror=e=>{console.error("Error al obtener cola de sincronizaci√≥n:",e),n("Error al obtener cola de sincronizaci√≥n")}}))}catch(e){throw console.error("Error en getSyncQueue:",e),e}},g=async e=>{try{console.log(`Eliminando elemento ${e} de la cola de sincronizaci√≥n...`);const o=await c();return new Promise(((n,a)=>{const r=o.transaction([s],"readwrite"),t=r.objectStore(s),i=t.delete(e);i.onsuccess=()=>{console.log(`Elemento ${e} eliminado de la cola de sincronizaci√≥n`),n(!0)},i.onerror=e=>{console.error("Error al eliminar de la cola de sincronizaci√≥n:",e),a("Error al eliminar de la cola de sincronizaci√≥n")}}))}catch(o){throw console.error("Error en removeFromSyncQueue:",o),o}},h=async()=>{const e=await c();console.log("Bases de datos disponibles:",e.name,"versi√≥n:",e.version),console.log("Almacenes disponibles:",Array.from(e.objectStoreNames))};setInterval(h,1e4);const f=async e=>{try{console.log(`Verificando almacenamiento del plato ID ${e}...`);const o=await c();return new Promise(((n,a)=>{const r=o.transaction([t],"readonly"),s=r.objectStore(t),i=s.get(e);i.onsuccess=o=>{const a=o.target.result;a?(console.log(`Verificaci√≥n exitosa: Plato ID ${e} encontrado en IndexedDB:`,a),n(a)):(console.error(`Verificaci√≥n fallida: Plato ID ${e} NO encontrado en IndexedDB`),n(null))},i.onerror=o=>{console.error(`Error al verificar plato ID ${e}:`,o.target.error),a(new Error(`Error al verificar plato ID ${e}: ${o.target.error.message}`))},r.oncomplete=()=>{console.log("Transacci√≥n de verificaci√≥n completada")}}))}catch(o){throw console.error("Error en verifyPlatoStorage:",o),o}};async function v(e){console.log("üçΩÔ∏è INICIO - Creando nuevo plato en IndexedDB:",e);try{if(!e||"object"!==typeof e)throw console.error("‚ùå ERROR: El plato debe ser un objeto v√°lido",e),new Error("El plato debe ser un objeto v√°lido");if(!e.name||""===e.name.trim())throw console.error("‚ùå ERROR: El plato debe tener un nombre v√°lido",e),new Error("El plato debe tener un nombre v√°lido");console.log("‚úÖ Validaci√≥n inicial del plato exitosa"),console.log("üîÑ Abriendo base de datos...");const o=await c();return console.log("‚úÖ Base de datos abierta correctamente"),new Promise(((n,a)=>{console.log("üîÑ Iniciando transacci√≥n para guardar plato...");try{const r=o.transaction([t],"readwrite");console.log("‚úÖ Transacci√≥n creada correctamente");const s=r.objectStore(t);console.log("‚úÖ Almac√©n obtenido correctamente");const i={...e,createdAt:e.createdAt||(new Date).toISOString(),updatedAt:(new Date).toISOString(),syncStatus:"pending",localTimestamp:(new Date).getTime()};i.id||(i.id=`plato_${Date.now()}_${Math.floor(1e4*Math.random())}`,console.log(`üÜî Generando ID para el plato: ${i.id}`)),console.log("üì¶ Intentando guardar plato con datos:",i);const c=s.put(i);c.onsuccess=async e=>{const o=i.id;console.log(`‚úÖ √âXITO: Plato guardado con ID: ${o}`);const a={...i};try{console.log("üîÑ Agregando plato a cola de sincronizaci√≥n..."),await m({type:"create",entityType:"plato",entityId:o,data:a,timestamp:(new Date).getTime()}),console.log("‚úÖ Plato agregado a la cola de sincronizaci√≥n correctamente")}catch(r){console.warn("‚ö†Ô∏è Error al agregar a cola de sincronizaci√≥n:",r)}console.log("üîç Verificando inmediatamente el almacenamiento del plato...");try{const e=await l();console.log(`üìä Total de platos en BD: ${e.length}`),console.log("üìã Lista de platos:",e);const n=e.find((e=>e.id===o));n?console.log("‚úÖ VERIFICACI√ìN EXITOSA: Plato encontrado en la lista completa"):console.error("‚ùå VERIFICACI√ìN FALLIDA: Plato NO encontrado en la lista completa")}catch(t){console.error("‚ùå Error al listar platos para verificaci√≥n:",t)}setTimeout((async()=>{try{console.log(`üîç Verificando persistencia del plato ID ${o}...`);const e=await f(o);e?console.log("‚úÖ VERIFICACI√ìN POSTERIOR: Plato confirmado en base de datos"):console.error("‚ùå VERIFICACI√ìN POSTERIOR FALLIDA: Plato no encontrado en verificaci√≥n")}catch(e){console.error("‚ùå Error en verificaci√≥n posterior:",e)}}),1e3),console.log("üèÅ Finalizando creaci√≥n del plato con √©xito"),n(a)},c.onerror=e=>{console.error("‚ùå ERROR al crear plato:",e.target.error),a(new Error(`Error al crear plato: ${e.target.error.message}`))},r.onerror=e=>{console.error("‚ùå ERROR en transacci√≥n:",e.target.error),a(new Error(`Error en transacci√≥n: ${e.target.error.message}`))},r.oncomplete=()=>{console.log("‚úÖ Transacci√≥n completada correctamente")}}catch(r){console.error("‚ùå ERROR al crear transacci√≥n:",r),a(new Error(`Error al crear transacci√≥n: ${r.message}`))}}))}catch(o){throw console.error("‚ùå ERROR GENERAL en createPlato:",o),o}}async function b(){console.log("üîç INICIANDO DEPURACI√ìN DE INDEXEDDB...");try{const e=await window.indexedDB.databases();console.log("üìä Bases de datos disponibles:",e);const o=await c();console.log("üì¶ Almacenes en la base de datos:",Array.from(o.objectStoreNames));const n=await l();console.log(`üìã Platos almacenados (${n.length}):`,n);const a=await p();return console.log(`üîÑ Cola de sincronizaci√≥n (${a.length}):`,a),console.log("‚úÖ DEPURACI√ìN COMPLETADA"),{databases:e,stores:Array.from(o.objectStoreNames),platos:n,syncQueue:a}}catch(e){throw console.error("‚ùå ERROR EN DEPURACI√ìN:",e),e}}function w(e){const o={...e};return o.name=o.name?.trim()||"Plato sin nombre",o.price="string"===typeof o.price?parseFloat(o.price)||0:o.price||0,o.is_available=!1!==o.is_available,o.availableQuantity=parseInt(o.availableQuantity)||0,o.includesDrink=!0===o.includesDrink,o.createdAt||(o.createdAt=(new Date).toISOString()),o.updatedAt=(new Date).toISOString(),o.syncStatus||(o.syncStatus="pending"),o.image&&"string"===typeof o.image&&o.image.length>2e5&&(console.warn("‚ö†Ô∏è Imagen demasiado grande, se reducir√° para evitar problemas de sincronizaci√≥n"),o.image_thumbnail=y(o.image),o.has_local_image=!0),o}function y(e){try{if(!e||!e.startsWith("data:"))return e;const o=e.match(/^data:([A-Za-z-+/]+);base64,(.+)$/);if(!o)return console.warn("‚ö†Ô∏è Formato de imagen no v√°lido para compresi√≥n"),e;const n=5e4,a=o[2];return a.length<=n?e:`data:${o[1]};base64,${a.substring(0,n)}`}catch(o){return console.error("‚ùå Error al comprimir imagen:",o),e}}async function E(e){console.log("üîÑ Iniciando guardado de plato con guardarPlato():",e);try{if(!e||"object"!==typeof e)throw new Error("Los datos del plato deben ser un objeto v√°lido");if(!e.name||""===e.name.trim())throw new Error("El plato debe tener un nombre v√°lido");const o=w(e);console.log("‚úÖ Datos normalizados:",o);const n=await v(o);return console.log("‚úÖ Plato guardado exitosamente:",n),n}catch(o){throw console.error("‚ùå Error en guardarPlato():",o),o}}const k=async e=>{try{console.log(`Obteniendo plato con ID ${e} de IndexedDB...`);const o=await c();return new Promise(((n,a)=>{const r=o.transaction([t],"readonly"),s=r.objectStore(t),i=s.get(e);i.onsuccess=o=>{const a=o.target.result;a?(console.log(`Plato con ID ${e} encontrado:`,a),n(a)):(console.log(`No se encontr√≥ plato con ID ${e}`),n(null))},i.onerror=o=>{console.error(`Error al obtener plato con ID ${e}:`,o),a(`Error al obtener plato con ID ${e}`)}}))}catch(o){throw console.error("Error en getPlato:",o),o}};"undefined"!==typeof window&&(window.debugDB=b,window.guardarPlato=E)},4887:function(e,o,n){n.d(o,{L3:function(){return i},lJ:function(){return t},qf:function(){return r},xE:function(){return s},zz:function(){return c}});var a=n(144);const r=(0,a.Kh)({show:!1,title:"Mensaje",message:"",confirmText:"Aceptar",cancelText:"Cancelar",showCancel:!1,resolvePromise:null});Boolean;function t(e,o={}){return new Promise((n=>{r.show=!0,r.message=e,r.title=o.title||"Confirmar",r.confirmText=o.confirmText||"Aceptar",r.cancelText=o.cancelText||"Cancelar",r.showCancel=!0,r.resolvePromise=n}))}function s(e,o={}){return new Promise((n=>{r.show=!0,r.message=e,r.title=o.title||"Mensaje",r.confirmText=o.confirmText||"Aceptar",r.showCancel=!1,r.resolvePromise=n}))}function i(){r.resolvePromise&&(r.resolvePromise(!0),r.resolvePromise=null),r.show=!1}function c(){r.resolvePromise&&(r.resolvePromise(!1),r.resolvePromise=null),r.show=!1}},6045:function(e,o,n){var a=n(5130),r=n(6768),t=n(4232),s=n(532),i=n.p+"img/moon.ef46db37.svg";const c={key:0,class:"ws-status reconnecting"},l={key:1,class:"ws-status error"},d={key:2,class:"main-nav"},u={class:"nav-container"},m={class:"nav-links"},p={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",class:"theme-icon"},g={key:1,src:s,alt:"Modo claro",class:"theme-icon"},h={key:0,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",class:"theme-icon"},f={key:1,src:i,alt:"Modo oscuro",class:"theme-icon"};function v(e,o,n,s,i,v){const b=(0,r.g2)("router-link"),w=(0,r.g2)("router-view"),y=(0,r.g2)("WhatsAppReservationHandler"),E=(0,r.g2)("WhatsAppSimulator"),k=(0,r.g2)("DialogContainer");return(0,r.uX)(),(0,r.CE)("div",{id:"app",class:(0,t.C4)({"dark-mode":i.isDarkMode})},[v.wsState.reconnecting?((0,r.uX)(),(0,r.CE)("div",c,[o[4]||(o[4]=(0,r.Lk)("span",{class:"loading-spinner"},null,-1)),(0,r.eW)(" Reconectando... (Intento "+(0,t.v_)(v.wsState.reconnectAttempts)+" de "+(0,t.v_)(v.wsState.maxReconnectAttempts)+") ",1),(0,r.Lk)("button",{onClick:o[0]||(o[0]=(...e)=>v.stopReconnecting&&v.stopReconnecting(...e)),class:"reconnect-btn stop-btn"},"Cancelar")])):v.wsState.error?((0,r.uX)(),(0,r.CE)("div",l,[o[5]||(o[5]=(0,r.Lk)("span",{class:"error-icon"},"‚ö†Ô∏è",-1)),(0,r.eW)(" Error de conexi√≥n: "+(0,t.v_)(v.wsState.error)+" ",1),(0,r.Lk)("button",{onClick:o[1]||(o[1]=(...e)=>v.handleReconnect&&v.handleReconnect(...e)),class:"reconnect-btn"},"Reconectar")])):(0,r.Q3)("",!0),v.showNav?((0,r.uX)(),(0,r.CE)("nav",d,[(0,r.Lk)("div",u,[(0,r.bF)(b,{to:"/",class:"nav-logo"},{default:(0,r.k6)((()=>o[6]||(o[6]=[(0,r.eW)("WebSAP")]))),_:1}),(0,r.Lk)("div",m,[(0,r.bF)(b,{to:"/"},{default:(0,r.k6)((()=>o[7]||(o[7]=[(0,r.eW)("Inicio")]))),_:1}),(0,r.bF)(b,{to:"/about"},{default:(0,r.k6)((()=>o[8]||(o[8]=[(0,r.eW)("Acerca de")]))),_:1}),i.isLoggedIn?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[(0,r.bF)(b,{to:"/menu"},{default:(0,r.k6)((()=>o[9]||(o[9]=[(0,r.eW)("Men√∫")]))),_:1}),v.isSuperAdmin?((0,r.uX)(),(0,r.Wv)(b,{key:0,to:"/superadmin"},{default:(0,r.k6)((()=>o[10]||(o[10]=[(0,r.eW)("Admin")]))),_:1})):(0,r.Q3)("",!0),v.isEmployee?((0,r.uX)(),(0,r.Wv)(b,{key:1,to:"/employee"},{default:(0,r.k6)((()=>o[11]||(o[11]=[(0,r.eW)("Panel Empleado")]))),_:1})):(0,r.Q3)("",!0),(0,r.Lk)("a",{href:"#",onClick:o[2]||(o[2]=(0,a.D$)(((...e)=>v.logout&&v.logout(...e)),["prevent"]))},"Cerrar Sesi√≥n")],64)):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.bF)(b,{to:"/login"},{default:(0,r.k6)((()=>o[12]||(o[12]=[(0,r.eW)("Iniciar Sesi√≥n")]))),_:1}),(0,r.bF)(b,{to:"/register"},{default:(0,r.k6)((()=>o[13]||(o[13]=[(0,r.eW)("Registrarse")]))),_:1})],64)),(0,r.Lk)("button",{onClick:o[3]||(o[3]=(...e)=>v.toggleDarkMode&&v.toggleDarkMode(...e)),class:"dark-mode-toggle","aria-label":"Cambiar modo oscuro"},[i.isDarkMode?((0,r.uX)(),(0,r.CE)(r.FK,{key:0},[i.svgFallback?((0,r.uX)(),(0,r.CE)("svg",p,o[14]||(o[14]=[(0,r.Lk)("path",{fill:"currentColor",d:"M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.166a.75.75 0 00-1.06-1.06l-1.591 1.59a.75.75 0 101.06 1.061l1.591-1.59zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.834 18.894a.75.75 0 001.06-1.06l-1.59-1.591a.75.75 0 10-1.061 1.06l1.59 1.591zM12 18a.75.75 0 01.75.75V21a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM7.758 17.303a.75.75 0 00-1.061-1.06l-1.591 1.59a.75.75 0 001.06 1.061l1.591-1.59zM6 12a.75.75 0 01-.75.75H3a.75.75 0 010-1.5h2.25A.75.75 0 016 12zM6.697 7.758a.75.75 0 001.06-1.061l-1.59-1.591a.75.75 0 00-1.061 1.06l1.59 1.591z"},null,-1)]))):((0,r.uX)(),(0,r.CE)("img",g))],64)):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[i.svgFallback?((0,r.uX)(),(0,r.CE)("svg",h,o[15]||(o[15]=[(0,r.Lk)("path",{fill:"currentColor",d:"M9.528 1.718a.75.75 0 01.162.819A8.97 8.97 0 009 6a9 9 0 009 9 8.97 8.97 0 003.463-.69.75.75 0 01.981.98 10.503 10.503 0 01-9.694 6.46c-5.799 0-10.5-4.701-10.5-10.5 0-4.368 2.667-8.112 6.46-9.694a.75.75 0 01.818.162z"},null,-1)]))):((0,r.uX)(),(0,r.CE)("img",f))],64))])])])])):(0,r.Q3)("",!0),(0,r.bF)(w),(0,r.bF)(y,{ref:"whatsappHandler"},null,512),(0,r.bF)(E),(0,r.bF)(k)],2)}n(4114);const b={key:0,class:"dialog-overlay"},w={class:"dialog-container"},y={class:"dialog-header"},E={class:"dialog-content"},k={class:"dialog-footer"};function S(e,o,n,a,s,i){return(0,r.uX)(),(0,r.CE)("div",null,[a.dialogState.show?((0,r.uX)(),(0,r.CE)("div",b,[(0,r.Lk)("div",w,[(0,r.Lk)("div",y,[(0,r.Lk)("h3",null,(0,t.v_)(a.dialogState.title),1)]),(0,r.Lk)("div",E,[(0,r.Lk)("p",null,(0,t.v_)(a.dialogState.message),1)]),(0,r.Lk)("div",k,[a.dialogState.showCancel?((0,r.uX)(),(0,r.CE)("button",{key:0,onClick:o[0]||(o[0]=(...e)=>a.handleCancel&&a.handleCancel(...e)),class:"dialog-button cancel-button"},(0,t.v_)(a.dialogState.cancelText),1)):(0,r.Q3)("",!0),(0,r.Lk)("button",{onClick:o[1]||(o[1]=(...e)=>a.handleConfirm&&a.handleConfirm(...e)),class:"dialog-button confirm-button"},(0,t.v_)(a.dialogState.confirmText),1)])])])):(0,r.Q3)("",!0)])}var I=n(4887),A={name:"DialogContainer",setup(){return{dialogState:I.qf,handleConfirm:I.L3,handleCancel:I.zz}}},$=n(1241);const L=(0,$.A)(A,[["render",S]]);var C=L,P=n(144),z=n(6429),x=n(7051);const D={style:{display:"none"}};var R={__name:"WhatsAppReservationHandler",setup(e,{expose:o}){const n=(0,P.KR)(!1),a=(0,P.KR)(""),t=async e=>{try{if(e===a.value)return void console.log("Mensaje ya procesado, ignorando duplicado:",e);console.log("Procesando mensaje de WhatsApp:",e),n.value=!0,a.value=e;const o=s(e);if(!o)return void console.warn("No se pudo extraer informaci√≥n de reserva del mensaje:",e);console.log("Datos extra√≠dos del mensaje:",o);const r=await(0,z.sb)(o);r.success?(console.log("Reserva de WhatsApp guardada correctamente:",r.reservation),x.A.emit("nueva-reserva",r.reservation),x.A.emit("refresh-reservations"),console.log("Eventos emitidos: nueva-reserva y refresh-reservations")):console.error("Error al guardar reserva de WhatsApp:",r.error)}catch(o){console.error("Error al procesar mensaje de WhatsApp:",o)}finally{n.value=!1}},s=e=>{try{const o=e.match(/\*Nombre:\*\s*([^\n]+)/i),n=e.match(/\*Tel√©fono m√≥vil:\*\s*([^\n]+)/i),a=e.match(/\*Fecha:\*\s*([^\n]+)/i),r=e.match(/\*Hora:\*\s*([^\n]+)/i),t=e.match(/\*Personas:\*\s*([^\n]+)/i),s=e.match(/\*Notas:\*\s*([^\n]+)/i),i=e.match(/\*Email:\*\s*([^\n]+)/i);return o||n?{nombre:o?o[1].trim():"Cliente sin nombre",telefono:n?n[1].trim():"",email:i?i[1].trim():"",fecha:a?a[1].trim():(new Date).toISOString().split("T")[0],hora:r?r[1].trim():"19:00",personas:t&&parseInt(t[1].trim(),10)||2,notas:s?s[1].trim():"Reserva desde WhatsApp"}:(console.warn("El mensaje no contiene informaci√≥n suficiente para una reserva"),null)}catch(o){return console.error("Error al extraer datos del mensaje:",o),null}},i=e=>{console.log("Mensaje de WhatsApp simulado recibido"),t(e)};return(0,r.sV)((()=>{console.log("WhatsAppReservationHandler montado"),x.A.on("whatsapp-message",i)})),(0,r.hi)((()=>{console.log("WhatsAppReservationHandler desmontado"),x.A.off("whatsapp-message",i)})),o({processWhatsAppMessage:t,simulateWhatsAppMessage:i}),(e,o)=>((0,r.uX)(),(0,r.CE)("div",D,o[0]||(o[0]=[(0,r.Lk)("p",null,"Manejador de reservas de WhatsApp activo",-1)])))}};const T=R;var _=T,M=n(1387);const N={key:0,class:"whatsapp-simulator"},O={key:0},j={key:1},W={key:0,class:"simulator-panel"},F={class:"form-group"},B={class:"form-group"},q={class:"form-group"},X={class:"form-group"},V={class:"form-group"},U={class:"form-group"},H={class:"form-group"},K={class:"buttons"},J=["disabled"];var Q={__name:"WhatsAppSimulator",setup(e,{expose:o}){const n=(0,M.lq)(),s=(0,P.KR)(!1),i=(0,P.KR)(!1),c=(0,P.KR)(null),l=(0,P.KR)(!1),d=(0,r.EW)((()=>{const e="login"===n.name,o="/login"===n.path||"/login/"===n.path;return console.log(`WhatsAppSimulator - Route check: name=${n.name}, path=${n.path}, isLoginRoute=${e}, isLoginPath=${o}`),e||o})),u=(0,r.EW)((()=>"shared-menu"===n.name||n.path.startsWith("/menu/"))),m=(0,r.EW)((()=>{const e=!d.value&&!u.value,o=e&&l.value;return console.log(`WhatsAppSimulator - Visibility check: isLoginPage=${d.value}, isSharedMenuView=${u.value}, shouldShow=${o}`),o})),p=e=>{console.log(`WhatsAppSimulator - Config changed: button enabled = ${e}`),l.value=e};(0,r.sV)((()=>{console.log(`WhatsAppSimulator - Component mounted on route: ${n.name} (${n.path})`);const e=localStorage.getItem("whatsappButtonEnabled");null!==e&&(l.value="true"===e,console.log(`WhatsAppSimulator - Loaded config: button enabled = ${l.value}`)),x.A.on("whatsapp-button-config-changed",p)})),(0,r.hi)((()=>{x.A.off("whatsapp-button-config-changed",p)}));const g=(0,P.Kh)({nombre:"",telefono:"",email:"",fecha:(new Date).toISOString().split("T")[0],hora:"20:00",personas:2,notas:""}),h=()=>{s.value=!s.value},f=async()=>{try{if(i.value=!0,c.value={type:"info",message:"Enviando reserva..."},!g.nombre||!g.telefono)return alert("Por favor, completa al menos el nombre y tel√©fono"),void(c.value={type:"error",message:"Faltan datos obligatorios"});console.log("Enviando reserva desde WhatsApp Simulator:",g);const e=`\n*NUEVA RESERVA DE MESA*\n---------------------------\n*Nombre:* ${g.nombre}\n*Tel√©fono m√≥vil:* ${g.telefono}\n${g.email?`*Email:* ${g.email}`:""}\n*Fecha:* ${g.fecha}\n*Hora:* ${g.hora}\n*Personas:* ${g.personas}\n${g.notas?`*Notas:* ${g.notas}`:""}\n---------------------------\nReserva enviada desde WhatsApp Simulator\n`;console.log("Emitiendo evento whatsapp-message con el mensaje:",e),x.A.emit("whatsapp-message",e),console.log("Emitiendo evento refresh-reservations"),x.A.emit("refresh-reservations"),c.value={type:"success",message:"Reserva enviada correctamente"},v()}catch(e){console.error("Error al enviar reserva:",e),c.value={type:"error",message:"Error al enviar la reserva: "+e.message}}finally{i.value=!1,setTimeout((()=>{c.value=null}),5e3)}},v=()=>{g.nombre="",g.telefono="",g.email="",g.fecha=(new Date).toISOString().split("T")[0],g.hora="20:00",g.personas=2,g.notas=""};return o({toggleSimulator:h,sendReservation:f}),(e,o)=>m.value?((0,r.uX)(),(0,r.CE)("div",N,[(0,r.Lk)("button",{onClick:h,class:"toggle-button"},[s.value?((0,r.uX)(),(0,r.CE)("span",O,"‚ùå Cerrar Simulador")):((0,r.uX)(),(0,r.CE)("span",j,"üì± Simular WhatsApp"))]),s.value?((0,r.uX)(),(0,r.CE)("div",W,[o[16]||(o[16]=(0,r.Lk)("h3",null,"Simulador de Reservas WhatsApp",-1)),(0,r.Lk)("div",F,[o[7]||(o[7]=(0,r.Lk)("label",{for:"nombre"},"Nombre:",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"nombre","onUpdate:modelValue":o[0]||(o[0]=e=>g.nombre=e),placeholder:"Nombre del cliente"},null,512),[[a.Jo,g.nombre]])]),(0,r.Lk)("div",B,[o[8]||(o[8]=(0,r.Lk)("label",{for:"telefono"},"Tel√©fono:",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",id:"telefono","onUpdate:modelValue":o[1]||(o[1]=e=>g.telefono=e),placeholder:"612345678"},null,512),[[a.Jo,g.telefono]])]),(0,r.Lk)("div",q,[o[9]||(o[9]=(0,r.Lk)("label",{for:"email"},"Email:",-1)),(0,r.bo)((0,r.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":o[2]||(o[2]=e=>g.email=e),placeholder:"cliente@example.com"},null,512),[[a.Jo,g.email]])]),(0,r.Lk)("div",X,[o[10]||(o[10]=(0,r.Lk)("label",{for:"fecha"},"Fecha:",-1)),(0,r.bo)((0,r.Lk)("input",{type:"date",id:"fecha","onUpdate:modelValue":o[3]||(o[3]=e=>g.fecha=e)},null,512),[[a.Jo,g.fecha]])]),(0,r.Lk)("div",V,[o[12]||(o[12]=(0,r.Lk)("label",{for:"hora"},"Hora:",-1)),(0,r.bo)((0,r.Lk)("select",{id:"hora","onUpdate:modelValue":o[4]||(o[4]=e=>g.hora=e)},o[11]||(o[11]=[(0,r.Fv)('<option value="13:00" data-v-40696f3f>13:00</option><option value="13:30" data-v-40696f3f>13:30</option><option value="14:00" data-v-40696f3f>14:00</option><option value="14:30" data-v-40696f3f>14:30</option><option value="20:00" data-v-40696f3f>20:00</option><option value="20:30" data-v-40696f3f>20:30</option><option value="21:00" data-v-40696f3f>21:00</option><option value="21:30" data-v-40696f3f>21:30</option>',8)]),512),[[a.u1,g.hora]])]),(0,r.Lk)("div",U,[o[14]||(o[14]=(0,r.Lk)("label",{for:"personas"},"Personas:",-1)),(0,r.bo)((0,r.Lk)("select",{id:"personas","onUpdate:modelValue":o[5]||(o[5]=e=>g.personas=e)},o[13]||(o[13]=[(0,r.Lk)("option",{value:1},"1 persona",-1),(0,r.Lk)("option",{value:2},"2 personas",-1),(0,r.Lk)("option",{value:3},"3 personas",-1),(0,r.Lk)("option",{value:4},"4 personas",-1),(0,r.Lk)("option",{value:5},"5 personas",-1),(0,r.Lk)("option",{value:6},"6 personas",-1),(0,r.Lk)("option",{value:8},"8 personas",-1)]),512),[[a.u1,g.personas]])]),(0,r.Lk)("div",H,[o[15]||(o[15]=(0,r.Lk)("label",{for:"notas"},"Notas:",-1)),(0,r.bo)((0,r.Lk)("textarea",{id:"notas","onUpdate:modelValue":o[6]||(o[6]=e=>g.notas=e),placeholder:"Notas adicionales"},null,512),[[a.Jo,g.notas]])]),(0,r.Lk)("div",K,[(0,r.Lk)("button",{onClick:f,class:"send-button",disabled:i.value},"Enviar Reserva",8,J)]),c.value?((0,r.uX)(),(0,r.CE)("div",{key:0,class:(0,t.C4)(["status",c.value.type])},(0,t.v_)(c.value.message),3)):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0)}};const G=(0,$.A)(Q,[["__scopeId","data-v-40696f3f"]]);var Y=G;function Z(e={}){try{const o={nombre:"Cliente de Prueba WhatsApp",telefono:"612345678",email:"whatsapp@example.com",fecha:(new Date).toISOString().split("T")[0],hora:"20:00",personas:2,notas:"Reserva realizada desde WhatsApp"},n={...o,...e};console.log(" Simulando mensaje de WhatsApp con datos:",n);const a={type:"whatsapp_reservation",reservation:n,timestamp:Date.now(),id:"whatsapp_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)};return x.A.emit("whatsapp_message",a),setTimeout((()=>{x.A.emit("refresh-reservations")}),1e3),console.log(" Simulaci√≥n de mensaje de WhatsApp completada"),!0}catch(o){return console.error(" Error al simular mensaje de WhatsApp:",o),!1}}window.testWhatsAppReservation=Z;function ee(){const e=["Juan P√©rez","Mar√≠a Garc√≠a","Carlos Rodr√≠guez","Ana Mart√≠nez","Luis L√≥pez","Laura S√°nchez","Pedro Gonz√°lez","Sof√≠a Fern√°ndez"],o=["612345678","623456789","634567890","645678901","656789012","667890123","678901234","689012345"],n=[],a=new Date;for(let s=1;s<=7;s++){const e=new Date(a);e.setDate(a.getDate()+s),n.push(e.toISOString().split("T")[0])}const r=["13:00","13:30","14:00","14:30","20:00","20:30","21:00","21:30"],t=[1,2,2,2,3,4,5,6,8];return{nombre:e[Math.floor(Math.random()*e.length)],telefono:o[Math.floor(Math.random()*o.length)],email:Math.random()>.5?`cliente${Math.floor(100*Math.random())}@example.com`:"",fecha:n[Math.floor(Math.random()*n.length)],hora:r[Math.floor(Math.random()*r.length)],personas:t[Math.floor(Math.random()*t.length)],notas:Math.random()>.7?"Mesa cerca de la ventana si es posible":Math.random()>.5?"Celebraci√≥n de cumplea√±os":Math.random()>.3?"Alergias: gluten":""}}function oe(){const e=ee();return console.log("Enviando reserva aleatoria:",e),Z(e)}function ne(e=3,o=2e3){console.log(`Enviando ${e} reservas aleatorias con intervalo de ${o}ms`);let n=0;const a=()=>{n<e?(oe(),n++,setTimeout(a,o)):console.log(`‚úÖ ${e} reservas enviadas correctamente`)};a()}window.testReservations={random:oe,multiple:ne,generate:ee};const ae=(0,P.Kh)({connected:!1,reconnecting:!1,error:null,reconnectAttempts:0,maxReconnectAttempts:5,socket:null,messages:[],enableWebsocket:!1});let re={reconnectInterval:2e3,reconnectAttempts:5},te=null;function se(e,o={}){if(re={...re,...o},ae.maxReconnectAttempts=re.reconnectAttempts,"WebSocket"in window){0,ae.socket&&ae.socket.close();try{ae.reconnecting=!1,ae.error=null,console.log(`Intentando conectar a WebSocket: ${e}`);const o=new WebSocket(e);o.onopen=()=>{console.log("Conexi√≥n WebSocket establecida"),ae.connected=!0,ae.reconnecting=!1,ae.error=null,ae.reconnectAttempts=0},o.onmessage=e=>{try{const o=JSON.parse(e.data);ae.messages.push(o),console.log("Mensaje recibido:",o)}catch(o){console.error("Error al parsear mensaje WebSocket:",e.data)}},o.onclose=e=>{ae.connected=!1,e.wasClean?console.log("Conexi√≥n WebSocket cerrada"):(console.log("Conexi√≥n WebSocket cerrada inesperadamente"),ce())},o.onerror=e=>{console.error("Error WebSocket:",e),ae.error="Error de conexi√≥n",ae.connected=!1,ae.reconnecting||ce()},ae.socket=o}catch(n){console.error("Error al inicializar WebSocket:",n),ae.error=`Error al inicializar: ${n.message}`,ae.connected=!1,ce()}}else console.warn("Este navegador no soporta WebSocket")}function ie(){ae.enableWebsocket=!1,ae.socket&&ue(),console.log("WebSocket deshabilitado")}function ce(){if(te&&clearTimeout(te),ae.reconnectAttempts>=ae.maxReconnectAttempts)return console.log("N√∫mero m√°ximo de reconexiones alcanzado"),void(ae.reconnecting=!1);ae.enableWebsocket,ae.reconnecting=!0,ae.reconnectAttempts++,console.log(`Programando reconexi√≥n ${ae.reconnectAttempts}/${ae.maxReconnectAttempts} en ${re.reconnectInterval}ms`),te=setTimeout((()=>{ae.socket&&ae.socket.url&&(console.log("Intentando reconexi√≥n..."),se(ae.socket.url))}),re.reconnectInterval)}function le(){ae.socket&&ae.socket.url&&se(ae.socket.url)}function de(){te&&clearTimeout(te),ae.reconnecting=!1,console.log("Intentos de reconexi√≥n detenidos")}function ue(){if(de(),ae.socket){try{ae.socket.close()}catch(e){console.error("Error al cerrar WebSocket:",e)}ae.socket=null}ae.connected=!1,console.log("Conexi√≥n WebSocket cerrada manualmente")}var me=n(981),pe=n(4216),ge=n(9098);const he="https://allseo.xyz/websapmenu",fe=`${he}/api`,ve={skipServerAvailabilityCheck:!0,maxPlatoSize:3e4,retryIntervals:[5e3,15e3,3e4],maxRetries:2,platoUrl:`${fe}/sync/platos`,emergencyPlatoUrl:`${fe}/platos`,useEmergencyEndpoint:!0};let be=!1,we=navigator.onLine;const ye=async()=>{if(!navigator.onLine)return!1;try{await fetch(`${fe}/favicon.ico`,{method:"HEAD",mode:"no-cors",cache:"no-store",credentials:"omit"});return!0}catch(e){return console.error("Error al verificar estado de conexi√≥n:",e),!1}},Ee=()=>{window.addEventListener("online",(async()=>{console.log("Evento online detectado"),we=await ye(),we&&(console.log("Conexi√≥n a Internet restablecida"),Ie())})),window.addEventListener("offline",(()=>{console.log("Evento offline detectado"),we=!1,console.log("Conexi√≥n a Internet perdida")})),ye().then((e=>{console.log("Estado inicial de conexi√≥n: "+(e?"En l√≠nea":"Fuera de l√≠nea"))}))},ke=async()=>{console.log("üîÑ Probando conexi√≥n con el servidor (modo emergencia)...");try{const e=new XMLHttpRequest,o=new Promise((o=>{const n=setTimeout((()=>{console.warn("‚è±Ô∏è Timeout en la prueba de conexi√≥n"),e.abort(),o(!1)}),5e3);e.onreadystatechange=function(){4===e.readyState&&(clearTimeout(n),e.status>=200&&e.status<300?(console.log("‚úÖ Conexi√≥n b√°sica establecida"),o(!0)):431===e.status?(console.error("‚ùå Error 431: Request Header Fields Too Large"),console.log("üëâ Necesitas reducir el tama√±o de las cookies o headers"),o(!1)):(console.error(`‚ùå Error en prueba de conexi√≥n: ${e.status}`),o(!1)))},e.onerror=function(){clearTimeout(n),console.error("‚ùå Error de red en prueba de conexi√≥n"),Se().then(o)},e.open("GET",`${fe}/test/ping`,!0),e.withCredentials=!1,e.send()}));return await o}catch(e){return console.error("‚ùå Error en prueba de conexi√≥n:",e),!1}},Se=async()=>{console.log("üîÑ Probando puertos alternativos...");const e=[8080,3e3,5e3,8e3];for(const n of e)try{console.log(`Probando en puerto: ${n}`);const e=await fetch("https://websapmenu.onrender.com/raw/ping",{method:"GET",mode:"no-cors",cache:"no-store",credentials:"omit"});if(e.ok||0===e.status)return console.log(`‚úÖ Servidor encontrado en puerto ${n}`),window.SERVER_PORT=n,!0}catch(o){console.log(`Puerto ${n} no disponible`)}return console.error("‚ùå No se encontr√≥ el servidor en ning√∫n puerto com√∫n"),!1},Ie=async()=>{if(!await ye())return console.log("Sin conexi√≥n a Internet, la sincronizaci√≥n no es posible"),!1;if(be)return console.log("Ya hay una sincronizaci√≥n en progreso"),!1;be=!0,console.log("üîÑ Iniciando sincronizaci√≥n de datos...");try{const o=await(0,pe.Hk)();console.log(`üìã Cola de sincronizaci√≥n: ${o.length} elementos`);for(const a of o)if("plato"===a.entityType){const o=await(0,pe.Ds)(a.entityId);if(o){console.log(`üçΩÔ∏è Sincronizando plato: ${o.name} (${o.id})`);try{const e=await Pe(o);e.success?(console.log(`‚úÖ Plato ${o.id} sincronizado correctamente`),await(0,pe.vh)(a.id)):console.error(`‚ùå Error al sincronizar plato ${o.id}`)}catch(e){console.error(`‚ùå Excepci√≥n al sincronizar plato ${o.id}:`,e)}}else console.warn(`‚ö†Ô∏è Plato ${a.entityId} no encontrado en IndexedDB`),await(0,pe.vh)(a.id)}console.log("üîç Buscando platos pendientes de sincronizaci√≥n...");const n=await(0,pe.Fk)();console.log(`üìã Platos pendientes: ${n.length}`);for(const a of n)try{console.log(`üçΩÔ∏è Sincronizando plato pendiente: ${a.name} (${a.id})`);const e=await Pe(a);e.success?console.log(`‚úÖ Plato pendiente ${a.id} sincronizado correctamente`):console.error(`‚ùå Error al sincronizar plato pendiente ${a.id}: ${e.error}`)}catch(e){console.error(`‚ùå Excepci√≥n al sincronizar plato pendiente ${a.id}: ${e}`)}return console.log("‚úÖ Sincronizaci√≥n completada"),!0}catch(o){return console.error("‚ùå Error durante la sincronizaci√≥n:",o),!1}finally{be=!1}},Ae=async(e,o)=>{try{console.log("üö® Intentando sincronizaci√≥n ultra-minimal para plato:",o);const n=new XMLHttpRequest,a=new Promise((e=>{const a=setTimeout((()=>{console.warn("‚è±Ô∏è Timeout en sincronizaci√≥n ultra-minimal"),n.abort(),e(!1)}),15e3);n.onreadystatechange=async function(){if(4===n.readyState)if(clearTimeout(a),n.status>=200&&n.status<300){console.log("‚úÖ Sincronizaci√≥n ultra-minimal exitosa");try{await(0,pe.rM)(o,"synced")}catch(r){console.error("Error al actualizar estado en BD:",r)}e(!0)}else console.error(`‚ùå Error en sincronizaci√≥n ultra-minimal: ${n.status}`),e(!1)},n.onerror=function(){clearTimeout(a),console.error("‚ùå Error de red en sincronizaci√≥n ultra-minimal"),e(!1)}}));n.open("POST",`${fe}/platos/emergency-sync`,!0),n.setRequestHeader("Content-Type","application/json");const r=await ze(e),t={id:r.id,name:(r.name||"").substring(0,30),price:Number(r.price)||0};return n.send(JSON.stringify(t)),await a}catch(n){return console.error("‚ùå Error en sincronizaci√≥n ultra-minimal:",n),!1}},$e=async(e,o,n=0)=>{const a=ve.maxRetries,r=await ze(e),t={id:r.id,name:r.name?.substring(0,50)||"Plato sin nombre",price:Number(r.price)||0,description:r.description?.substring(0,100)||"",category:r.category||"principal",image:r.image,is_available:Boolean(r.is_available),minimal_sync:!0};return new Promise((s=>{const i=setTimeout((()=>{console.warn("‚è±Ô∏è Timeout global de la operaci√≥n de sincronizaci√≥n"),s(!1)}),3e4),c=new XMLHttpRequest;c.timeout=15e3,c.onreadystatechange=async function(){if(4===c.readyState)if(c.status>=200&&c.status<300){clearTimeout(i);try{await(0,pe.rM)(o,"synced"),console.log(`‚úÖ Sincronizaci√≥n exitosa para plato ${o}`)}catch(e){console.error("Error al actualizar estado:",e)}s(!0)}else 0===c.status?(console.warn("‚ö†Ô∏è Conexi√≥n interrumpida"),l()):431===c.status?(console.error("‚ùå Error 431 (Headers demasiado grandes) - Intentando m√©todo ultraminimal"),Ae(r,o).then((e=>{clearTimeout(i),s(e)}))):(console.error(`‚ùå Error HTTP ${c.status} en sincronizaci√≥n`),l())},c.ontimeout=function(){console.warn("‚è±Ô∏è Timeout de la petici√≥n HTTP"),l()},c.onerror=function(){console.error("‚ùå Error de red en sincronizaci√≥n"),l()};const l=()=>{if(n<a){const r=ve.retryIntervals[n]||5e3;console.log(`üîÑ Reintentando en ${r}ms... (${n+1}/${a})`),setTimeout((()=>{clearTimeout(i),$e(e,o,n+1).then((e=>s(e)))}),r)}else clearTimeout(i),console.warn("‚ùå Agotados todos los reintentos de sincronizaci√≥n"),s(!1)};try{c.open("POST",`${fe}/platos`,!0),c.setRequestHeader("Content-Type","application/json"),c.send(JSON.stringify(t))}catch(d){console.error("‚ùå Error al iniciar la petici√≥n:",d),l()}}))},Le=async()=>{try{console.log("üîÑ Configurando sincronizaci√≥n...");const e=await fetch(`${fe}/sync/setup`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"omit",body:JSON.stringify({force:!1})});if(e.ok){const o=await e.json();return console.log("‚úÖ Configuraci√≥n de sincronizaci√≥n completada:",o),!0}return console.error("‚ùå Error al configurar sincronizaci√≥n:",await e.text()),!1}catch(e){return console.error("‚ùå Error al configurar sincronizaci√≥n:",e),!1}},Ce=()=>{console.log("üîÑ Inicializando servicio de sincronizaci√≥n..."),Promise.all([ke()]).then((([e,o])=>{if(console.log(`‚úÖ Estado de conexi√≥n directa - API: ${e}`),e)if(Ee(),o&&o.mysql&&o.mysql.connected){console.log("üìä MySQL conectado, procediendo con sincronizaci√≥n"),Ie();setInterval(Ie,6e4)}else console.log("‚ö†Ô∏è MySQL no est√° configurado correctamente, intentando configurar..."),Le().then((e=>{if(e){console.log("‚úÖ Configuraci√≥n exitosa, iniciando sincronizaci√≥n"),Ie();setInterval(Ie,6e4)}}));else console.error("‚ùå No se pudo establecer conexi√≥n con el servidor.")})),console.log("‚öôÔ∏è Servicio de sincronizaci√≥n inicializado")},Pe=async e=>{console.log(`üîÑ Sincronizando plato: ${e.name} (ID: ${e.id})`);try{const n=await ze(e);console.log("üì§ Datos a enviar:",{...n,image:n.image?"Imagen en base64 (omitida en log)":null});const a=ve.platoUrl;console.log(`üîó URL de sincronizaci√≥n: ${a}`);const r=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n),credentials:"omit"});if(!r.ok){const o=await r.text();return console.error(`‚ùå Error de sincronizaci√≥n (${r.status}): ${o}`),r.status>=400?(console.log("‚ö†Ô∏è Intentando sincronizaci√≥n minimalista como fallback..."),await $e(e)):{success:!1,message:`Error de servidor: ${r.status} ${r.statusText}`,error:o}}const t=await r.json();console.log("‚úÖ Sincronizaci√≥n exitosa:",t);try{await(0,pe.rM)(e.id,!0),console.log(`‚úÖ Estado de sincronizaci√≥n actualizado para plato ID: ${e.id}`)}catch(o){console.warn(`‚ö†Ô∏è No se pudo actualizar el estado de sincronizaci√≥n: ${o.message}`)}return{success:!0,message:"Plato sincronizado correctamente",data:t}}catch(n){return console.error("‚ùå Error en sincronizaci√≥n:",n),console.log("‚ö†Ô∏è Intentando sincronizaci√≥n minimalista como fallback..."),await $e(e)}},ze=async e=>{const o={...e};if(o.id=e.id,o.name=e.name||"Plato sin nombre",o.price=parseFloat(e.price)||0,o.description=e.description||"",o.category=e.category||"principal",e.image&&"string"===typeof e.image&&e.image.length>0)try{o.image=await(0,ge.z)(e.image),console.log(`Imagen optimizada para ${e.name}`)}catch(n){console.warn(`Error al optimizar imagen para ${e.name}:`,n),o.image=e.image}else o.image=e.image||null;return o.image_url=e.image_url||"",o.is_available=!1!==e.is_available,o.includesDrink=e.includesDrink||!1,o.availableQuantity=e.availableQuantity||0,o};var xe={name:"App",components:{DialogContainer:C,WhatsAppReservationHandler:_,WhatsAppSimulator:Y},data(){return{isLoggedIn:(0,me.wR)(),isDarkMode:"true"===localStorage.getItem("darkMode"),svgFallback:!1,whatsappHandler:null}},computed:{wsState(){return ae},showNav(){return!this.$route.path.match(/^\/menu\/[^\/]+$/)},isSuperAdmin(){return this.isLoggedIn&&(0,me.hf)("Superadministrador")},isEmployee(){return this.isLoggedIn&&(0,me.hf)("Empleado")}},watch:{$route(){this.isLoggedIn=(0,me.wR)()}},methods:{logout(){(0,me.ri)(),this.isLoggedIn=!1,this.$router.push("/")},toggleDarkMode(){this.isDarkMode=!this.isDarkMode,localStorage.setItem("darkMode",this.isDarkMode),(0,r.dY)((()=>{this.isDarkMode?(document.documentElement.classList.add("dark-mode"),document.body.classList.add("dark-mode")):(document.documentElement.classList.remove("dark-mode"),document.body.classList.remove("dark-mode"))}))},handleReconnect(){le()},stopReconnecting(){stopReconnecting()}},mounted(){const e=new Image;if(e.onerror=()=>{console.warn("Error al cargar im√°genes SVG, usando fallback inline"),this.svgFallback=!0},e.src=n(532),this.isDarkMode&&(document.documentElement.classList.add("dark-mode"),document.body.classList.add("dark-mode")),null===localStorage.getItem("darkMode")){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;this.isDarkMode=e,localStorage.setItem("darkMode",e),e&&(document.documentElement.classList.add("dark-mode"),document.body.classList.add("dark-mode"))}ie(),Ce()},unmounted(){ue()}};const De=(0,$.A)(xe,[["render",v]]);var Re=De;n(8111),n(3579);const Te={class:"home-container"},_e={class:"auth-options"},Me={class:"menu-options"};function Ne(e,o,n,a,t,s){const i=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",Te,[o[4]||(o[4]=(0,r.Lk)("h1",null,"Sistema de Gesti√≥n de Men√∫",-1)),(0,r.Lk)("div",_e,[(0,r.bF)(i,{to:"/login",class:"auth-button login"},{default:(0,r.k6)((()=>o[1]||(o[1]=[(0,r.eW)("Iniciar Sesi√≥n")]))),_:1}),(0,r.bF)(i,{to:"/register",class:"auth-button register"},{default:(0,r.k6)((()=>o[2]||(o[2]=[(0,r.eW)("Registrarse")]))),_:1})]),o[5]||(o[5]=(0,r.Fv)('<div class="login-info" data-v-4e8e3a5c><p data-v-4e8e3a5c>Para probar la aplicaci√≥n, puedes usar estas credenciales:</p><ul data-v-4e8e3a5c><li data-v-4e8e3a5c><strong data-v-4e8e3a5c>Email:</strong> superadmin@example.com | <strong data-v-4e8e3a5c>Contrase√±a:</strong>SuperAdmin2023</li><li data-v-4e8e3a5c><strong data-v-4e8e3a5c>Email:</strong> admin@example.com | <strong data-v-4e8e3a5c>Contrase√±a:</strong>Admin2023</li><li data-v-4e8e3a5c><strong data-v-4e8e3a5c>Email:</strong> empleado@example.com | <strong data-v-4e8e3a5c>Contrase√±a:</strong>Empleado2023</li></ul></div>',1)),(0,r.Lk)("div",Me,[(0,r.Lk)("div",{class:"option-card",onClick:o[0]||(o[0]=(...e)=>a.goToMenu&&a.goToMenu(...e))},o[3]||(o[3]=[(0,r.Lk)("h2",null,"Gestionar Men√∫",-1),(0,r.Lk)("p",null,"Configura tu men√∫, precios y formas de pago",-1)]))])])}var Oe={name:"HomeView",setup(){const e=(0,M.rd)(),o=()=>{e.push("/menu")};return{goToMenu:o}}};const je=(0,$.A)(Oe,[["render",Ne],["__scopeId","data-v-4e8e3a5c"]]);var We=je;const Fe={class:"login-container"},Be={class:"login-card"},qe={class:"form-group"},Xe={class:"form-group"},Ve={key:0,class:"error-message"},Ue=["disabled"],He={class:"login-options"};function Ke(e,o,n,s,i,c){const l=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",Fe,[(0,r.Lk)("div",Be,[o[7]||(o[7]=(0,r.Lk)("h1",{class:"login-title"},"Iniciar Sesi√≥n",-1)),(0,r.Lk)("form",{onSubmit:o[2]||(o[2]=(0,a.D$)(((...e)=>s.handleLogin&&s.handleLogin(...e)),["prevent"])),class:"login-form"},[(0,r.Lk)("div",qe,[o[4]||(o[4]=(0,r.Lk)("label",{for:"email"},"Correo electr√≥nico",-1)),(0,r.bo)((0,r.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":o[0]||(o[0]=e=>s.email=e),required:"",placeholder:"Ingresa tu correo"},null,512),[[a.Jo,s.email]])]),(0,r.Lk)("div",Xe,[o[5]||(o[5]=(0,r.Lk)("label",{for:"password"},"Contrase√±a",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",id:"password","onUpdate:modelValue":o[1]||(o[1]=e=>s.password=e),required:"",placeholder:"Ingresa tu contrase√±a"},null,512),[[a.Jo,s.password]])]),s.errorMessage?((0,r.uX)(),(0,r.CE)("div",Ve,(0,t.v_)(s.errorMessage),1)):(0,r.Q3)("",!0),(0,r.Lk)("button",{type:"submit",disabled:s.isLoading,class:"login-button"},(0,t.v_)(s.isLoading?"Iniciando sesi√≥n...":"Iniciar Sesi√≥n"),9,Ue)],32),(0,r.Lk)("div",He,[(0,r.bF)(l,{to:"/register"},{default:(0,r.k6)((()=>o[6]||(o[6]=[(0,r.eW)("¬øNo tienes cuenta? Reg√≠strate")]))),_:1}),(0,r.Lk)("a",{href:"#",onClick:o[3]||(o[3]=(0,a.D$)(((...e)=>s.handleForgotPassword&&s.handleForgotPassword(...e)),["prevent"]))},"¬øOlvidaste tu contrase√±a?")])])])}var Je={name:"LoginView",setup(){const e=(0,M.rd)(),o=((0,M.lq)(),(0,P.KR)("")),n=(0,P.KR)(""),a=(0,P.KR)(!1),r=(0,P.KR)(""),t=async()=>{r.value="",a.value=!0;try{localStorage.clear(),sessionStorage.clear(),console.log("Intentando login con:",o.value);const a=await(0,me.iD)(o.value,n.value);console.log("Login exitoso:",a),localStorage.setItem("isLoggedIn","true"),a.user.roles&&a.user.roles.includes("Superadministrador")?e.push("/superadmin"):a.user.roles&&a.user.roles.includes("Administrador")?e.push("/admin"):e.push("/employee")}catch(t){console.error("Error de login:",t),r.value=t.message||"Error al iniciar sesi√≥n"}finally{a.value=!1}},s=async()=>{await(0,I.xE)("Funci√≥n de recuperaci√≥n de contrase√±a no implementada en esta versi√≥n de demostraci√≥n.")};return{email:o,password:n,isLoading:a,errorMessage:r,handleLogin:t,handleForgotPassword:s}}};const Qe=(0,$.A)(Je,[["render",Ke],["__scopeId","data-v-7af9a333"]]);var Ge=Qe;const Ye=[{path:"/",name:"home",component:We},{path:"/about",name:"about",component:()=>n.e(594).then(n.bind(n,7633))},{path:"/login",name:"login",component:Ge,meta:{requiresGuest:!0}},{path:"/register",name:"register",component:()=>n.e(224).then(n.bind(n,8506))},{path:"/menu",name:"menu",component:()=>Promise.all([n.e(982),n.e(226),n.e(598),n.e(854)]).then(n.bind(n,7598)),meta:{requiresAuth:!0}},{path:"/menu/:id",name:"shared-menu",component:()=>Promise.all([n.e(982),n.e(226),n.e(260)]).then(n.bind(n,6438)),props:!0},{path:"/menu/:id",name:"PublicMenu",component:()=>n.e(272).then(n.bind(n,3591)),props:!0},{path:"/superadmin",name:"superadmin",component:()=>Promise.all([n.e(982),n.e(987),n.e(441)]).then(n.bind(n,3145)),meta:{requiresAuth:!0,roles:["Superadministrador"]}},{path:"/admin",name:"admin",component:()=>Promise.all([n.e(982),n.e(226),n.e(598),n.e(987),n.e(70),n.e(970),n.e(884)]).then(n.bind(n,6296)),meta:{requiresAuth:!0,roles:["Administrador","Superadministrador"]}},{path:"/admin/sync-business-info",name:"sync-business-info",component:()=>Promise.all([n.e(982),n.e(70),n.e(838)]).then(n.bind(n,4070)),meta:{requiresAuth:!0,roles:["Administrador","Superadministrador"]}},{path:"/employee",name:"employee",component:()=>Promise.all([n.e(982),n.e(226),n.e(598),n.e(970),n.e(83)]).then(n.bind(n,4398)),meta:{requiresAuth:!0,roles:["Empleado"]}},{path:"/platos",name:"platos",component:()=>n.e(770).then(n.bind(n,646)),meta:{requiresAuth:!0,roles:["Administrador","Superadministrador"]}},{path:"/admin/usuarios",name:"admin-usuarios",component:()=>n.e(654).then(n.bind(n,2995)),meta:{requiresAuth:!0,roles:["Administrador","Superadministrador"]}},{path:"/admin/restaurantes",name:"admin-restaurantes",component:()=>n.e(328).then(n.bind(n,1929)),meta:{requiresAuth:!0,roles:["Administrador","Superadministrador"]}},{path:"/reservas",name:"reservas",component:()=>n.e(140).then(n.bind(n,1641)),meta:{requiresAuth:!0,roles:["Administrador","Superadministrador","Empleado"]}},{path:"/:pathMatch(.*)*",name:"notFound",component:()=>n.e(463).then(n.bind(n,2463))}],Ze=(0,M.aE)({history:(0,M.LA)("/websapmenu/"),routes:Ye});Ze.beforeEach((async(e,o,n)=>{const a=e.matched.some((e=>e.meta.requiresAuth)),r=e.matched.some((e=>e.meta.requiresGuest)),t=e.meta.roles;if("/login"===e.path&&(localStorage.removeItem("user"),localStorage.removeItem("isLoggedIn"),(0,me.eF)()),a&&!(0,me.wR)())await(0,I.xE)("Debe iniciar sesi√≥n para acceder a esta p√°gina",{title:"Acceso Restringido"}),n({name:"login"});else if(r&&(0,me.wR)()){const e=(0,me.HW)();e&&e.roles?e.roles.includes("Superadministrador")?n({name:"superadmin"}):e.roles.includes("Administrador")?n({name:"admin"}):n({name:"employee"}):n({name:"home"})}else if(t&&(0,me.wR)()){const e=t.some((e=>(0,me.hf)(e)));e?n():(await(0,I.xE)("No tiene permisos para acceder a esta secci√≥n",{title:"Acceso Denegado"}),n({name:"home"}))}else n()}));var eo=Ze;function oo(){try{const e=window.location.pathname;if(e.startsWith("/menu/")){const o=e.split("/menu/")[1];o&&(console.log("Detectada URL de men√∫ p√∫blico:",o),window.MENU_PUBLIC_ID=o)}}catch(e){console.error("Error al detectar URL:",e)}}window.MENU_PUBLIC_ID=null,oo();const no=(0,a.Ef)(Re);no.use(eo),no.mount("#app")},6429:function(e,o,n){n.d(o,{CN:function(){return p},MT:function(){return m},S1:function(){return i},SG:function(){return c},sB:function(){return l},sb:function(){return d}});n(8111),n(1701);var a=n(133),r=n(7051);let t=[];try{const e=localStorage.getItem("websap_reservations");e&&(t=JSON.parse(e),console.log("Reservas cargadas desde localStorage:",t.length))}catch(h){console.error("Error al cargar reservas desde localStorage:",h)}function s(){try{localStorage.setItem("websap_reservations",JSON.stringify(t))}catch(h){console.error("Error al guardar reservas en localStorage:",h)}}async function i(e){try{const n=localStorage.getItem("token");n&&a["default"].setToken(n);const i="res_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),c={id:i,fullName:e.fullName,mobilePhone:e.mobilePhone,landlinePhone:e.landlinePhone||"",email:e.email||"",address:e.address||"",date:e.reservationDate,time:e.reservationTime,peopleCount:e.peopleCount,notes:e.additionalNotes||"",status:"pending",createdAt:(new Date).toISOString(),source:e.source||"web"};try{const o=await a["default"].post("/whatsapp/reservas",{nombre:c.fullName,telefono:c.mobilePhone,email:c.email,fecha:c.date,hora:c.time,personas:c.peopleCount,notas:c.notes,created_by:e.created_by||localStorage.getItem("userId")||null,usuario_id:e.usuario_id||("user"===localStorage.getItem("userType")?localStorage.getItem("userId"):null)});o.data&&o.data.success&&(console.log("Reserva guardada en el backend:",o.data),c.id=o.data.reservationId||c.id)}catch(o){console.warn("No se pudo guardar la reserva en el backend, usando almacenamiento local:",o)}return t.unshift(c),s(),r.A.emit("nueva-reserva",c),console.log("Reserva guardada correctamente:",c),{success:!0,reservation:c}}catch(h){return console.error("Error al guardar la reserva:",h),{success:!1,error:h.message||"Error al guardar la reserva"}}}async function c(){try{const e=localStorage.getItem("token");e&&a["default"].setToken(e);try{const e=await a["default"].get("/whatsapp/reservas");if(e&&e.success&&Array.isArray(e.reservas)){console.log("‚úÖ Reservas obtenidas desde el backend:",e.reservas.length);const o=e.reservas.map((e=>({id:e.id,fullName:e.nombre,mobilePhone:e.telefono,email:e.email||"",date:g(e.fecha),time:e.hora,peopleCount:e.personas,notes:e.notas||"",status:"confirmada"===e.estado?"confirmed":"cancelada"===e.estado?"cancelled":"pending",createdAt:e.creado_en,source:e.origen||"web",created_by:e.created_by,usuario_id:e.usuario_id})));return t=o,s(),{success:!0,reservations:o}}}catch(h){console.warn("Error al obtener reservas desde el backend, usando datos locales:",h)}console.log("üìã Usando datos de reservas locales:",t.length);const o=t.map((e=>({...e,date:g(e.date)})));return 0===o.length?{success:!0,reservations:[]}:{success:!0,reservations:o}}catch(h){return console.error("‚ùå Error al obtener las reservas:",h),{success:!1,error:h.message||"Error al obtener las reservas"}}}async function l(e,o){try{try{const n=await a["default"].put(`/whatsapp/reservas/${e}`,{estado:"confirmed"===o?"confirmada":"cancelled"===o?"cancelada":"pendiente"});n.data&&n.data.success&&console.log("Estado de reserva actualizado en el backend:",n.data)}catch(n){console.warn("No se pudo actualizar el estado de la reserva en el backend:",n)}const i=t.findIndex((o=>o.id===e));if(-1===i)throw new Error("Reserva no encontrada");return t[i].status=o,s(),r.A.emit("reserva-actualizada",{id:e,status:o}),{success:!0,message:"Estado de reserva actualizado correctamente"}}catch(h){return console.error("Error al actualizar el estado de la reserva:",h),{success:!1,error:h.message||"Error al actualizar el estado de la reserva"}}}async function d(e){console.log("Procesando reserva desde WhatsApp:",e);const o=localStorage.getItem("token");o&&a["default"].setToken(o);const n={...e,created_by:e.created_by||localStorage.getItem("userId")||null,usuario_id:e.usuario_id||("user"===localStorage.getItem("userType")?localStorage.getItem("userId"):null)};try{const e=await a["default"].post("/whatsapp/reservas",n),o={id:e.reservationId||Date.now().toString(),fullName:n.nombre,mobilePhone:n.telefono,email:n.email||"",date:g(n.fecha),time:n.hora,peopleCount:n.personas||2,notes:n.notas||"",status:"pending",createdAt:(new Date).toISOString(),source:"whatsapp",created_by:n.created_by,usuario_id:n.usuario_id};return{success:!0,reservation:o,message:"Reserva guardada correctamente"}}catch(h){return console.warn("‚ö†Ô∏è No se pudo guardar la reserva en el backend, pero se guard√≥ localmente:",h),await u(n),{status:"local",success:!0,reservation:{id:Date.now().toString(),fullName:n.nombre,mobilePhone:n.telefono,email:n.email||"",date:g(n.fecha),time:n.hora,peopleCount:n.personas||2,notes:n.notas||"",status:"pending",createdAt:(new Date).toISOString(),source:"whatsapp",created_by:n.created_by,usuario_id:n.usuario_id},message:"Reserva guardada localmente debido a un error de conexi√≥n"}}}async function u(e){try{const o={id:"local_"+Date.now(),fullName:e.nombre||e.fullName,mobilePhone:e.telefono||e.mobilePhone,email:e.email||"",date:g(e.fecha||e.date),time:e.hora||e.time,peopleCount:e.personas||e.peopleCount,notes:e.notas||e.notes||"",status:"pending",createdAt:(new Date).toISOString(),source:"whatsapp",created_by:e.created_by||localStorage.getItem("userId")||null,usuario_id:e.usuario_id||("user"===localStorage.getItem("userType")?localStorage.getItem("userId"):null),pendingSave:!0};return t.unshift(o),s(),r.A.emit("nueva-reserva",o),o}catch(h){throw console.error("Error al guardar reserva localmente:",h),h}}async function m(e){try{try{const o=await a["default"].delete(`/reservas/${e}`);console.log("Reserva eliminada en el backend:",o)}catch(o){console.warn("No se pudo eliminar la reserva en el backend:",o)}const n=t.findIndex((o=>o.id===e));return-1!==n?(t.splice(n,1),s(),r.A.emit("reserva-eliminada",{id:e}),{success:!0,message:"Reserva eliminada correctamente"}):{success:!1,error:"No se encontr√≥ la reserva especificada"}}catch(h){return console.error("Error al eliminar reserva:",h),{success:!1,error:h.message||"Error al eliminar la reserva"}}}function p(e,o=30){if(!e||!e.date)return!1;const n=new Date(e.date),a=new Date,r=a-n,t=Math.ceil(r/864e5);return t>o}function g(e){if(!e)return"";try{if(e.includes("T")&&e.includes("/")){const o=e.split("/");if(3===o.length){const e=o[0].split("T")[0];return`${e}/${o[1]}/${o[2]}`}}if(e.includes("-")){const o=e.split("-");if(3===o.length)return`${o[2]}/${o[1]}/${o[0]}`}if(e.includes("/")&&!e.includes("T"))return e;const o=new Date(e);if(!isNaN(o.getTime())){const e=o.getDate().toString().padStart(2,"0"),n=(o.getMonth()+1).toString().padStart(2,"0"),a=o.getFullYear();return`${e}/${n}/${a}`}return e}catch(h){return console.error("Error al formatear fecha:",h),e}}o.Ay={saveReservation:i,getReservations:c,updateReservationStatus:l,saveWhatsAppReservation:d,deleteReservation:m,isReservationOlderThan:p}},7051:function(e,o,n){n(4114),n(8111),n(7588);var a=n(144);class r{constructor(){this.events=(0,a.Kh)({})}on(e,o){this.events[e]||(this.events[e]=[]),this.events[e].push(o)}off(e,o){if(this.events[e])if(o){const n=this.events[e].indexOf(o);n>-1&&this.events[e].splice(n,1)}else this.events[e]=[]}emit(e,o){this.events[e]&&this.events[e].forEach((e=>{e(o)}))}}o.A=new r},9098:function(e,o,n){n.d(o,{z:function(){return r}});const a=(e,o=800,n=.7)=>new Promise(((a,r)=>{try{if(!e||"string"!==typeof e)return console.warn("La imagen no es v√°lida para compresi√≥n"),void a(e);const r=new Image;r.onload=()=>{const t=document.createElement("canvas");let s=r.width,i=r.height;s>o&&(i=Math.round(i*o/s),s=o),t.width=s,t.height=i;const c=t.getContext("2d");c.drawImage(r,0,0,s,i);const l=t.toDataURL("image/jpeg",n);l.length<e.length?(console.log(`Imagen comprimida: ${Math.round(l.length/1024)}KB (original: ${Math.round(e.length/1024)}KB)`),a(l)):(console.log("La compresi√≥n no redujo el tama√±o, manteniendo original"),a(e))},r.onerror=()=>{console.warn("Error al cargar la imagen para compresi√≥n"),a(e)},e.startsWith("data:image")?r.src=e:r.src="data:image/jpeg;base64,"+e}catch(t){console.error("Error en la compresi√≥n de imagen:",t),a(e)}})),r=async(e,o=500)=>{try{if(!e||"string"!==typeof e)return e;const n=Math.round(e.length/1024);if(n<=o)return e;console.log(`Optimizando imagen de ${n}KB (m√°ximo: ${o}KB)`);let r=.7;n>3*o?r=.5:n>2*o&&(r=.6);let t=await a(e,800,r);return t.length/1024>o&&(t=await a(t,600,.5)),t.length/1024>o&&(t=await a(t,400,.4)),t}catch(n){return console.error("Error al optimizar imagen:",n),e}}}},o={};function n(a){var r=o[a];if(void 0!==r)return r.exports;var t=o[a]={exports:{}};return e[a].call(t.exports,t,t.exports,n),t.exports}n.m=e,function(){var e=[];n.O=function(o,a,r,t){if(!a){var s=1/0;for(d=0;d<e.length;d++){a=e[d][0],r=e[d][1],t=e[d][2];for(var i=!0,c=0;c<a.length;c++)(!1&t||s>=t)&&Object.keys(n.O).every((function(e){return n.O[e](a[c])}))?a.splice(c--,1):(i=!1,t<s&&(s=t));if(i){e.splice(d--,1);var l=r();void 0!==l&&(o=l)}}return o}t=t||0;for(var d=e.length;d>0&&e[d-1][2]>t;d--)e[d]=e[d-1];e[d]=[a,r,t]}}(),function(){n.n=function(e){var o=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(o,{a:o}),o}}(),function(){var e,o=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};n.t=function(a,r){if(1&r&&(a=this(a)),8&r)return a;if("object"===typeof a&&a){if(4&r&&a.__esModule)return a;if(16&r&&"function"===typeof a.then)return a}var t=Object.create(null);n.r(t);var s={};e=e||[null,o({}),o([]),o(o)];for(var i=2&r&&a;"object"==typeof i&&!~e.indexOf(i);i=o(i))Object.getOwnPropertyNames(i).forEach((function(e){s[e]=function(){return a[e]}}));return s["default"]=function(){return a},n.d(t,s),t}}(),function(){n.d=function(e,o){for(var a in o)n.o(o,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:o[a]})}}(),function(){n.f={},n.e=function(e){return Promise.all(Object.keys(n.f).reduce((function(o,a){return n.f[a](e,o),o}),[]))}}(),function(){n.u=function(e){return"js/"+({83:"employee",140:"reservas",224:"register",260:"shared-menu",272:"public-menu",328:"admin-restaurantes",441:"superadmin",594:"about",654:"admin-usuarios",770:"platos",884:"admin"}[e]||e)+"."+{70:"1c38969d",83:"2825684d",125:"e9da6f0a",140:"61e740ef",179:"e3067561",224:"35df2468",226:"2f25ca18",260:"7f999ff2",272:"2810c342",328:"76a07f44",427:"491b8825",441:"1a98d8a8",460:"ab4a3450",463:"01ddc7d1",594:"f3711a76",598:"a6a76911",654:"a5494afb",770:"23cb5a5b",884:"6ca59a3b",970:"72132177",982:"42cce96a",987:"71b11cd9"}[e]+".js"}}(),function(){n.miniCssF=function(e){return"css/"+({83:"employee",140:"reservas",224:"register",260:"shared-menu",272:"public-menu",328:"admin-restaurantes",441:"superadmin",594:"about",654:"admin-usuarios",770:"platos",838:"sync-business-info",854:"menu",884:"admin"}[e]||e)+"."+{83:"b640972d",140:"e1c71206",224:"2f3b7f9e",260:"958e1098",272:"79d08f67",328:"4d8e7f9a",441:"d9ebc473",463:"9936a330",594:"187c5855",654:"4bcf276b",770:"c0475d53",838:"183a93b2",854:"58efb2c6",884:"353ff12f",987:"24701949"}[e]+".css"}}(),function(){n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){n.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)}}(),function(){var e={},o="websap:";n.l=function(a,r,t,s){if(e[a])e[a].push(r);else{var i,c;if(void 0!==t)for(var l=document.getElementsByTagName("script"),d=0;d<l.length;d++){var u=l[d];if(u.getAttribute("src")==a||u.getAttribute("data-webpack")==o+t){i=u;break}}i||(c=!0,i=document.createElement("script"),i.charset="utf-8",i.timeout=120,n.nc&&i.setAttribute("nonce",n.nc),i.setAttribute("data-webpack",o+t),i.src=a),e[a]=[r];var m=function(o,n){i.onerror=i.onload=null,clearTimeout(p);var r=e[a];if(delete e[a],i.parentNode&&i.parentNode.removeChild(i),r&&r.forEach((function(e){return e(n)})),o)return o(n)},p=setTimeout(m.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=m.bind(null,i.onerror),i.onload=m.bind(null,i.onload),c&&document.head.appendChild(i)}}}(),function(){n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){n.p="/websapmenu/"}(),function(){if("undefined"!==typeof document){var e=function(e,o,a,r,t){var s=document.createElement("link");s.rel="stylesheet",s.type="text/css",n.nc&&(s.nonce=n.nc);var i=function(n){if(s.onerror=s.onload=null,"load"===n.type)r();else{var a=n&&n.type,i=n&&n.target&&n.target.href||o,c=new Error("Loading CSS chunk "+e+" failed.\n("+a+": "+i+")");c.name="ChunkLoadError",c.code="CSS_CHUNK_LOAD_FAILED",c.type=a,c.request=i,s.parentNode&&s.parentNode.removeChild(s),t(c)}};return s.onerror=s.onload=i,s.href=o,a?a.parentNode.insertBefore(s,a.nextSibling):document.head.appendChild(s),s},o=function(e,o){for(var n=document.getElementsByTagName("link"),a=0;a<n.length;a++){var r=n[a],t=r.getAttribute("data-href")||r.getAttribute("href");if("stylesheet"===r.rel&&(t===e||t===o))return r}var s=document.getElementsByTagName("style");for(a=0;a<s.length;a++){r=s[a],t=r.getAttribute("data-href");if(t===e||t===o)return r}},a=function(a){return new Promise((function(r,t){var s=n.miniCssF(a),i=n.p+s;if(o(s,i))return r();e(a,i,null,r,t)}))},r={524:0};n.f.miniCss=function(e,o){var n={83:1,140:1,224:1,260:1,272:1,328:1,441:1,463:1,594:1,654:1,770:1,838:1,854:1,884:1,987:1};r[e]?o.push(r[e]):0!==r[e]&&n[e]&&o.push(r[e]=a(e).then((function(){r[e]=0}),(function(o){throw delete r[e],o})))}}}(),function(){var e={524:0};n.f.j=function(o,a){var r=n.o(e,o)?e[o]:void 0;if(0!==r)if(r)a.push(r[2]);else if(/^8(38|54)$/.test(o))e[o]=0;else{var t=new Promise((function(n,a){r=e[o]=[n,a]}));a.push(r[2]=t);var s=n.p+n.u(o),i=new Error,c=function(a){if(n.o(e,o)&&(r=e[o],0!==r&&(e[o]=void 0),r)){var t=a&&("load"===a.type?"missing":a.type),s=a&&a.target&&a.target.src;i.message="Loading chunk "+o+" failed.\n("+t+": "+s+")",i.name="ChunkLoadError",i.type=t,i.request=s,r[1](i)}};n.l(s,c,"chunk-"+o,o)}},n.O.j=function(o){return 0===e[o]};var o=function(o,a){var r,t,s=a[0],i=a[1],c=a[2],l=0;if(s.some((function(o){return 0!==e[o]}))){for(r in i)n.o(i,r)&&(n.m[r]=i[r]);if(c)var d=c(n)}for(o&&o(a);l<s.length;l++)t=s[l],n.o(e,t)&&e[t]&&e[t][0](),e[t]=0;return n.O(d)},a=self["webpackChunkwebsap"]=self["webpackChunkwebsap"]||[];a.forEach(o.bind(null,0)),a.push=o.bind(null,a.push.bind(a))}();var a=n.O(void 0,[504],(function(){return n(6045)}));a=n.O(a)})();
//# sourceMappingURL=app.469dac43.js.map