"use strict";(self["webpackChunkwebsap"]=self["webpackChunkwebsap"]||[]).push([[140],{1641:function(e,a,r){r.r(a),r.d(a,{default:function(){return ce}});var s=r(6768),t=r(4232),o=r(5130);const l={class:"reservas-view"},n={class:"container py-4"},c={class:"row"},i={class:"col-12"},d={class:"card"},u={class:"card-body"},v={key:0,class:"text-center my-5"},k={key:1,class:"alert alert-danger"},m={key:2},f={class:"mb-4"},g={class:"row g-3"},L={class:"col-md-3"},h={class:"col-md-3"},b={class:"col-md-3"},y={class:"col-md-3"},p=["value"],E={class:"col-12"},w={class:"table-responsive"},C={class:"table table-striped table-hover"},R={class:"text-muted"},S={class:"text-muted d-block"},_={class:"btn-group"},D=["onClick"],I=["onClick"],M=["onClick"],F={key:0,class:"text-center py-5"},T={class:"modal",id:"detallesModal"},X={class:"modal-content"},A={class:"modal-header"},W={key:0,class:"modal-body"},H={class:"row mb-3"},N={class:"col-md-6"},$={class:"col-md-6"},P={class:"row mb-3"},U={class:"col-md-6"},z={class:"col-md-6"},Q={class:"row mb-3"},x={class:"col-md-6"},B={class:"col-md-6"},V={class:"row mb-3"},J={class:"col-md-6"},K={class:"col-md-6"},O={class:"row mb-3"},Y={class:"col-12"},j={class:"row mb-3"},q={class:"col-12"},G={class:"mt-2"},Z={class:"row mb-3"},ee={class:"col-12"},ae={class:"modal-footer"};function re(e,a,r,re,se,te){return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",n,[(0,s.Lk)("div",c,[(0,s.Lk)("div",i,[a[25]||(a[25]=(0,s.Lk)("h1",{class:"mb-4"},"Reservas",-1)),(0,s.Lk)("div",d,[(0,s.Lk)("div",u,[se.loading?((0,s.uX)(),(0,s.CE)("div",v,a[10]||(a[10]=[(0,s.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,s.Lk)("span",{class:"visually-hidden"},"Cargando...")],-1),(0,s.Lk)("p",{class:"mt-2"},"Cargando reservas...",-1)]))):se.error?((0,s.uX)(),(0,s.CE)("div",k,(0,t.v_)(se.error),1)):((0,s.uX)(),(0,s.CE)("div",m,[(0,s.Lk)("div",f,[a[19]||(a[19]=(0,s.Lk)("h4",null,"Filtros",-1)),(0,s.Lk)("div",g,[(0,s.Lk)("div",L,[a[11]||(a[11]=(0,s.Lk)("label",{for:"fechaDesde",class:"form-label"},"Fecha desde",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date",class:"form-control",id:"fechaDesde","onUpdate:modelValue":a[0]||(a[0]=e=>se.filtros.fechaDesde=e)},null,512),[[o.Jo,se.filtros.fechaDesde]])]),(0,s.Lk)("div",h,[a[12]||(a[12]=(0,s.Lk)("label",{for:"fechaHasta",class:"form-label"},"Fecha hasta",-1)),(0,s.bo)((0,s.Lk)("input",{type:"date",class:"form-control",id:"fechaHasta","onUpdate:modelValue":a[1]||(a[1]=e=>se.filtros.fechaHasta=e)},null,512),[[o.Jo,se.filtros.fechaHasta]])]),(0,s.Lk)("div",b,[a[14]||(a[14]=(0,s.Lk)("label",{for:"estado",class:"form-label"},"Estado",-1)),(0,s.bo)((0,s.Lk)("select",{class:"form-select",id:"estado","onUpdate:modelValue":a[2]||(a[2]=e=>se.filtros.estado=e)},a[13]||(a[13]=[(0,s.Lk)("option",{value:""},"Todos",-1),(0,s.Lk)("option",{value:"pendiente"},"Pendiente",-1),(0,s.Lk)("option",{value:"confirmada"},"Confirmada",-1),(0,s.Lk)("option",{value:"cancelada"},"Cancelada",-1)]),512),[[o.u1,se.filtros.estado]])]),(0,s.Lk)("div",y,[a[16]||(a[16]=(0,s.Lk)("label",{for:"restaurante",class:"form-label"},"Restaurante",-1)),(0,s.bo)((0,s.Lk)("select",{class:"form-select",id:"restaurante","onUpdate:modelValue":a[3]||(a[3]=e=>se.filtros.restauranteId=e)},[a[15]||(a[15]=(0,s.Lk)("option",{value:""},"Todos",-1)),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(se.restaurantes,(e=>((0,s.uX)(),(0,s.CE)("option",{key:e.id,value:e.id},(0,t.v_)(e.nombre),9,p)))),128))],512),[[o.u1,se.filtros.restauranteId]])]),(0,s.Lk)("div",E,[(0,s.Lk)("button",{class:"btn btn-primary",onClick:a[4]||(a[4]=(...e)=>te.aplicarFiltros&&te.aplicarFiltros(...e))},a[17]||(a[17]=[(0,s.Lk)("i",{class:"fas fa-filter"},null,-1),(0,s.eW)(" Aplicar Filtros ")])),(0,s.Lk)("button",{class:"btn btn-secondary ms-2",onClick:a[5]||(a[5]=(...e)=>te.limpiarFiltros&&te.limpiarFiltros(...e))},a[18]||(a[18]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1),(0,s.eW)(" Limpiar Filtros ")]))])])]),(0,s.Lk)("div",w,[(0,s.Lk)("table",C,[a[23]||(a[23]=(0,s.Lk)("thead",null,[(0,s.Lk)("tr",null,[(0,s.Lk)("th",null,"ID"),(0,s.Lk)("th",null,"Cliente"),(0,s.Lk)("th",null,"Fecha"),(0,s.Lk)("th",null,"Hora"),(0,s.Lk)("th",null,"Personas"),(0,s.Lk)("th",null,"Restaurante"),(0,s.Lk)("th",null,"Estado"),(0,s.Lk)("th",null,"Acciones")])],-1)),(0,s.Lk)("tbody",null,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(se.reservas,(e=>((0,s.uX)(),(0,s.CE)("tr",{key:e.id},[(0,s.Lk)("td",null,(0,t.v_)(e.id),1),(0,s.Lk)("td",null,[(0,s.Lk)("div",null,(0,t.v_)(e.nombre),1),(0,s.Lk)("small",R,(0,t.v_)(e.telefono),1),(0,s.Lk)("small",S,(0,t.v_)(e.email||"Sin email"),1)]),(0,s.Lk)("td",null,(0,t.v_)(te.formatDate(e.fecha)),1),(0,s.Lk)("td",null,(0,t.v_)(te.formatTime(e.hora)),1),(0,s.Lk)("td",null,(0,t.v_)(e.personas),1),(0,s.Lk)("td",null,(0,t.v_)(te.getRestauranteName(e.restaurante_id)),1),(0,s.Lk)("td",null,[(0,s.Lk)("span",{class:(0,t.C4)(te.getEstadoClass(e.estado))},(0,t.v_)(e.estado),3)]),(0,s.Lk)("td",null,[(0,s.Lk)("div",_,[(0,s.Lk)("button",{class:"btn btn-sm btn-info",onClick:a=>te.verDetalles(e)},a[20]||(a[20]=[(0,s.Lk)("i",{class:"fas fa-eye"},null,-1)]),8,D),"pendiente"===e.estado?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"btn btn-sm btn-success",onClick:a=>te.confirmarReserva(e)},a[21]||(a[21]=[(0,s.Lk)("i",{class:"fas fa-check"},null,-1)]),8,I)):(0,s.Q3)("",!0),"cancelada"!==e.estado?((0,s.uX)(),(0,s.CE)("button",{key:1,class:"btn btn-sm btn-danger",onClick:a=>te.cancelarReserva(e)},a[22]||(a[22]=[(0,s.Lk)("i",{class:"fas fa-times"},null,-1)]),8,M)):(0,s.Q3)("",!0)])])])))),128))])])]),0===se.reservas.length?((0,s.uX)(),(0,s.CE)("div",F,a[24]||(a[24]=[(0,s.Lk)("p",null,"No se encontraron reservas con los filtros aplicados.",-1)]))):(0,s.Q3)("",!0)]))])])])])]),(0,s.Lk)("div",T,[(0,s.Lk)("div",X,[(0,s.Lk)("div",A,[a[26]||(a[26]=(0,s.Lk)("h5",{class:"modal-title",id:"detallesModalLabel"},"Detalles de la Reserva",-1)),(0,s.Lk)("button",{type:"button",class:"btn-close",onClick:a[6]||(a[6]=e=>te.closeModal("detallesModal"))})]),se.reservaSeleccionada?((0,s.uX)(),(0,s.CE)("div",W,[(0,s.Lk)("div",H,[(0,s.Lk)("div",N,[a[27]||(a[27]=(0,s.Lk)("strong",null,"Cliente:",-1)),(0,s.eW)(" "+(0,t.v_)(se.reservaSeleccionada.nombre),1)]),(0,s.Lk)("div",$,[a[28]||(a[28]=(0,s.Lk)("strong",null,"Teléfono:",-1)),(0,s.eW)(" "+(0,t.v_)(se.reservaSeleccionada.telefono),1)])]),(0,s.Lk)("div",P,[(0,s.Lk)("div",U,[a[29]||(a[29]=(0,s.Lk)("strong",null,"Email:",-1)),(0,s.eW)(" "+(0,t.v_)(se.reservaSeleccionada.email||"No proporcionado"),1)]),(0,s.Lk)("div",z,[a[30]||(a[30]=(0,s.Lk)("strong",null,"Personas:",-1)),(0,s.eW)(" "+(0,t.v_)(se.reservaSeleccionada.personas),1)])]),(0,s.Lk)("div",Q,[(0,s.Lk)("div",x,[a[31]||(a[31]=(0,s.Lk)("strong",null,"Fecha:",-1)),(0,s.eW)(" "+(0,t.v_)(te.formatDate(se.reservaSeleccionada.fecha)),1)]),(0,s.Lk)("div",B,[a[32]||(a[32]=(0,s.Lk)("strong",null,"Hora:",-1)),(0,s.eW)(" "+(0,t.v_)(te.formatTime(se.reservaSeleccionada.hora)),1)])]),(0,s.Lk)("div",V,[(0,s.Lk)("div",J,[a[33]||(a[33]=(0,s.Lk)("strong",null,"Estado:",-1)),(0,s.Lk)("span",{class:(0,t.C4)(te.getEstadoClass(se.reservaSeleccionada.estado))},(0,t.v_)(se.reservaSeleccionada.estado),3)]),(0,s.Lk)("div",K,[a[34]||(a[34]=(0,s.Lk)("strong",null,"Origen:",-1)),(0,s.eW)(" "+(0,t.v_)(se.reservaSeleccionada.origen||"Web"),1)])]),(0,s.Lk)("div",O,[(0,s.Lk)("div",Y,[a[35]||(a[35]=(0,s.Lk)("strong",null,"Restaurante:",-1)),(0,s.eW)(" "+(0,t.v_)(te.getRestauranteName(se.reservaSeleccionada.restaurante_id)),1)])]),(0,s.Lk)("div",j,[(0,s.Lk)("div",q,[a[36]||(a[36]=(0,s.Lk)("strong",null,"Notas:",-1)),(0,s.Lk)("p",G,(0,t.v_)(se.reservaSeleccionada.notas||"Sin notas adicionales"),1)])]),(0,s.Lk)("div",Z,[(0,s.Lk)("div",ee,[a[37]||(a[37]=(0,s.Lk)("strong",null,"Creada el:",-1)),(0,s.eW)(" "+(0,t.v_)(te.formatDateTime(se.reservaSeleccionada.creado_en)),1)])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",ae,[(0,s.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:a[7]||(a[7]=e=>te.closeModal("detallesModal"))},"Cerrar"),se.reservaSeleccionada&&"pendiente"===se.reservaSeleccionada.estado?((0,s.uX)(),(0,s.CE)("button",{key:0,type:"button",class:"btn btn-success",onClick:a[8]||(a[8]=(...e)=>te.confirmarReservaModal&&te.confirmarReservaModal(...e))}," Confirmar Reserva ")):(0,s.Q3)("",!0),se.reservaSeleccionada&&"cancelada"!==se.reservaSeleccionada.estado?((0,s.uX)(),(0,s.CE)("button",{key:1,type:"button",class:"btn btn-danger",onClick:a[9]||(a[9]=(...e)=>te.cancelarReservaModal&&te.cancelarReservaModal(...e))}," Cancelar Reserva ")):(0,s.Q3)("",!0)])])])])}r(8111),r(116);var se=r(6429),te=r(2639),oe={name:"ReservasView",data(){return{reservas:[],restaurantes:[],loading:!0,error:null,reservaSeleccionada:null,detallesModal:null,filtros:{fechaDesde:"",fechaHasta:"",estado:"",restauranteId:""}}},async mounted(){await this.loadData()},methods:{async loadData(){try{this.loading=!0,this.error=null;const e=await te.Ay.getRestaurantes();this.restaurantes=e.data,await this.cargarReservas()}catch(e){console.error("Error al cargar datos:",e),this.error="Error al cargar los datos. Por favor, inténtelo de nuevo."}finally{this.loading=!1}},async cargarReservas(){try{const e={};this.filtros.fechaDesde&&(e.fechaDesde=this.filtros.fechaDesde),this.filtros.fechaHasta&&(e.fechaHasta=this.filtros.fechaHasta),this.filtros.estado&&(e.estado=this.filtros.estado),this.filtros.restauranteId&&(e.restauranteId=this.filtros.restauranteId);const a=await se.Ay.getReservas(e);this.reservas=a.data}catch(e){console.error("Error al cargar reservas:",e),this.error="Error al cargar las reservas. Por favor, inténtelo de nuevo."}},verDetalles(e){this.reservaSeleccionada={...e},document.getElementById("detallesModal").style.display="block"},async confirmarReserva(e){try{await se.Ay.actualizarEstado(e.id,"confirmada"),alert("Reserva confirmada correctamente"),await this.cargarReservas()}catch(a){console.error("Error al confirmar reserva:",a),alert("Error al confirmar la reserva. Por favor, inténtelo de nuevo.")}},async cancelarReserva(e){try{await se.Ay.actualizarEstado(e.id,"cancelada"),alert("Reserva cancelada correctamente"),await this.cargarReservas()}catch(a){console.error("Error al cancelar reserva:",a),alert("Error al cancelar la reserva. Por favor, inténtelo de nuevo.")}},async confirmarReservaModal(){await this.confirmarReserva(this.reservaSeleccionada),document.getElementById("detallesModal").style.display="none"},async cancelarReservaModal(){await this.cancelarReserva(this.reservaSeleccionada),document.getElementById("detallesModal").style.display="none"},aplicarFiltros(){this.cargarReservas()},limpiarFiltros(){this.filtros={fechaDesde:"",fechaHasta:"",estado:"",restauranteId:""},this.cargarReservas()},formatDate(e){if(!e)return"N/A";const a=new Date(e);return a.toLocaleDateString()},formatTime(e){return e?e.substring(0,5):"N/A"},formatDateTime(e){if(!e)return"N/A";const a=new Date(e);return a.toLocaleString()},getEstadoClass(e){switch(e){case"pendiente":return"badge bg-warning";case"confirmada":return"badge bg-success";case"cancelada":return"badge bg-danger";default:return"badge bg-secondary"}},getRestauranteName(e){if(!e)return"Sin asignar";const a=this.restaurantes.find((a=>a.id===e));return a?a.nombre:"Desconocido"},closeModal(e){document.getElementById(e).style.display="none"}}},le=r(1241);const ne=(0,le.A)(oe,[["render",re],["__scopeId","data-v-05573d88"]]);var ce=ne},2639:function(e,a,r){r.d(a,{AY:function(){return n},BL:function(){return c},XR:function(){return l},sl:function(){return t}});var s=r(133);async function t(){try{const e=localStorage.getItem("token");e&&s["default"].setToken(e);const a=await s["default"].get("/restaurantes");if(a&&a.success)return{success:!0,restaurantes:a.restaurantes||[]};throw new Error(a.message||"Error al obtener restaurantes")}catch(e){return console.error("Error al obtener restaurantes:",e),{success:!1,error:e.message||"Error al obtener restaurantes",restaurantes:[]}}}async function o(e){try{const a=localStorage.getItem("token");a&&s["default"].setToken(a);const r=await s["default"].get(`/restaurantes/${e}`);if(r&&r.success)return{success:!0,restaurante:r.restaurante};throw new Error(r.message||"Error al obtener restaurante")}catch(a){return console.error(`Error al obtener restaurante ${e}:`,a),{success:!1,error:a.message||"Error al obtener restaurante"}}}async function l(e){try{const a=localStorage.getItem("token");a&&s["default"].setToken(a);const r=await s["default"].post("/restaurantes",e);if(r&&r.success)return{success:!0,restaurante:r.restaurante,message:r.message||"Restaurante creado correctamente"};throw new Error(r.message||"Error al crear restaurante")}catch(a){return console.error("Error al crear restaurante:",a),{success:!1,error:a.message||"Error al crear restaurante"}}}async function n(e,a){try{const r=localStorage.getItem("token");r&&s["default"].setToken(r);const t=await s["default"].put(`/restaurantes/${e}`,a);if(t&&t.success)return{success:!0,restaurante:t.restaurante,message:t.message||"Restaurante actualizado correctamente"};throw new Error(t.message||"Error al actualizar restaurante")}catch(r){return console.error(`Error al actualizar restaurante ${e}:`,r),{success:!1,error:r.message||"Error al actualizar restaurante"}}}async function c(e){try{const a=localStorage.getItem("token");a&&s["default"].setToken(a);const r=await s["default"].post(`/restaurantes/${e}/regenerate-link`);if(r&&r.success)return{success:!0,enlace_compartido:r.enlace_compartido,message:r.message||"Enlace regenerado correctamente"};throw new Error(r.message||"Error al regenerar enlace")}catch(a){return console.error(`Error al regenerar enlace para restaurante ${e}:`,a),{success:!1,error:a.message||"Error al regenerar enlace"}}}async function i(e,a){try{const r=localStorage.getItem("token");r&&s["default"].setToken(r);const t=await s["default"].post(`/restaurantes/${e}/asignar-usuario/${a}`);if(t&&t.success)return{success:!0,message:t.message||"Usuario asignado correctamente"};throw new Error(t.message||"Error al asignar usuario")}catch(r){return console.error(`Error al asignar usuario ${a} a restaurante ${e}:`,r),{success:!1,error:r.message||"Error al asignar usuario"}}}async function d(){try{const e=await t();return e.success&&e.restaurantes.length>0?{success:!0,restaurante:e.restaurantes[0]}:{success:!1,error:"No se encontró ningún restaurante asociado al usuario",restaurante:null}}catch(e){return console.error("Error al obtener restaurante del usuario:",e),{success:!1,error:e.message||"Error al obtener restaurante del usuario",restaurante:null}}}a.Ay={getRestaurantes:t,getRestaurante:o,createRestaurante:l,updateRestaurante:n,regenerateLink:c,assignUserToRestaurant:i,getCurrentUserRestaurant:d}}}]);
//# sourceMappingURL=reservas.61e740ef.js.map