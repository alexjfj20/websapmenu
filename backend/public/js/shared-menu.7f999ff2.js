"use strict";(self["webpackChunkwebsap"]=self["webpackChunkwebsap"]||[]).push([[260],{2949:function(e,a,n){n.d(a,{Bg:function(){return f},D2:function(){return g},Jo:function(){return y},Vg:function(){return b},ag:function(){return p},qW:function(){return h},xr:function(){return v}});var o=n(133),t=n(8982),r=n(7051);const s=3e4,i=3e5;let l=null,c=0,u=0,d=null,m=!1;async function p(){try{const e=await(0,t.By)();if(!e||0===Object.keys(e).length)return console.log("No hay informaci√≥n del negocio para sincronizar"),{success:!1,message:"No hay informaci√≥n del negocio para sincronizar"};console.log("Sincronizando informaci√≥n del negocio con el backend:",e);const a=localStorage.getItem("token");a&&o["default"].setToken(a);const n=await o["default"].get("/auth/me");if(!n||!n.success||!n.user||!n.user.restaurante_id)return console.warn("No se pudo obtener el restaurante del usuario actual"),{success:!1,message:"No se pudo obtener el restaurante del usuario actual"};const s=n.user.restaurante_id,i={nombre:e.name,descripcion:e.description,direccion:e.address,telefono:e.contact,logo:e.logo,informacion_pago:JSON.stringify(e.paymentInfo||{})},l=await o["default"].put(`/restaurantes/${s}`,i);return l&&l.success?(console.log("Informaci√≥n del negocio sincronizada con √©xito"),c=Date.now(),r.A.emit("business-info-updated",e),{success:!0,message:"Informaci√≥n del negocio sincronizada con √©xito",timestamp:c}):(console.warn("Error al sincronizar informaci√≥n del negocio:",l),{success:!1,message:l.message||"Error al sincronizar informaci√≥n del negocio"})}catch(e){return console.error("Error al sincronizar informaci√≥n del negocio:",e),{success:!1,message:e.message||"Error al sincronizar informaci√≥n del negocio"}}}async function v(e=!1){try{const n=Date.now();if(d&&!e&&n-u<i)return console.log("Usando informaci√≥n de negocio en cach√©"),d;const s=localStorage.getItem("token");s&&o["default"].setToken(s);const l=await o["default"].get("/auth/me");if(!l||!l.success||!l.user||!l.user.restaurante_id)throw console.warn("No se pudo obtener el restaurante del usuario actual"),new Error("No se pudo obtener el restaurante del usuario actual");const c=l.user.restaurante_id,m=await o["default"].get(`/restaurantes/${c}`);if(m&&m.success&&m.restaurante){const e=m.restaurante;let o={};try{e.informacion_pago&&(o=JSON.parse(e.informacion_pago))}catch(a){console.warn("Error al parsear informaci√≥n de pago:",a)}const s={name:e.nombre,description:e.descripcion,address:e.direccion,contact:e.telefono,logo:e.logo,paymentInfo:o};return await(0,t.AU)(s),d=s,u=n,r.A.emit("business-info-updated",s),console.log("Informaci√≥n del negocio obtenida con √©xito:",s),s}throw console.warn("Error al obtener informaci√≥n del negocio:",m),new Error(m?.message||"Error al obtener informaci√≥n del negocio")}catch(n){console.error("Error al obtener informaci√≥n del negocio desde el backend:",n);try{const e=await(0,t.By)();if(e)return e}catch(s){console.error("Error al obtener informaci√≥n local:",s)}throw n}}async function f(){try{const e=await(0,t.By)(),a=await v(!0),n=JSON.stringify(e),o=JSON.stringify(a),s=n!==o;return s&&(console.log("Se detectaron cambios en la informaci√≥n del negocio"),await(0,t.AU)(a),r.A.emit("business-info-updated",a)),s}catch(e){return console.error("Error al verificar cambios en informaci√≥n del negocio:",e),!1}}function g(e=!1){e?console.log("Sincronizaci√≥n de informaci√≥n del negocio desactivada (modo vista compartida)"):(l&&clearInterval(l),m||(v().catch((e=>console.error("Error en sincronizaci√≥n inicial:",e))),m=!0),l=setInterval((()=>{f().catch((e=>console.error("Error en verificaci√≥n peri√≥dica:",e)))}),s),console.log("Verificaci√≥n peri√≥dica de informaci√≥n del negocio iniciada"))}function b(){l&&(clearInterval(l),l=null,console.log("Verificaci√≥n peri√≥dica de informaci√≥n del negocio detenida"))}async function y(){try{const e=localStorage.getItem("token");e&&o["default"].setToken(e);const a=await o["default"].get("/restaurantes/migrate/add-informacion-pago");return a&&a.success?(console.log("Migraci√≥n ejecutada con √©xito:",a.message),{success:!0,message:a.message||"Migraci√≥n ejecutada con √©xito"}):(console.warn("Error al ejecutar migraci√≥n:",a),{success:!1,message:a.message||"Error al ejecutar migraci√≥n"})}catch(e){return console.error("Error al ejecutar migraci√≥n:",e),{success:!1,message:e.message||"Error al ejecutar migraci√≥n"}}}function h(){d=null,u=0}},6438:function(e,a,n){n.r(a),n.d(a,{default:function(){return ea}});var o=n(6768),t=n(4232),r=n(5130);const s=["id"],i={key:0,class:"loading"},l={key:1,class:"error"},c={key:2,class:"menu-content"},u={key:0,class:"business-info"},d={key:0,class:"business-header-banner"},m=["src"],p={class:"business-content"},v={class:"description"},f={key:0,class:"contact-info"},g={key:0},b={key:1},y={class:"menu-list"},h={class:"menu-items"},k={class:"item-image-container"},I=["src"],L={key:1,src:"https://via.placeholder.com/150?text=Sin+Imagen",alt:"Sin imagen disponible",class:"item-image"},E={class:"item-details"},C={class:"item-description"},w={class:"item-price"},D={key:0,class:"includes-drink"},$=["onClick","disabled"],P={key:0,class:"btn-icon"},N={key:1,class:"btn-icon"},q={key:0,class:"menu-list special-menu-list"},S={class:"menu-items"},R={class:"item-image-container"},A=["src"],Q={key:1,src:"https://via.placeholder.com/150?text=Sin+Imagen",alt:"Sin imagen disponible",class:"item-image"},_={class:"item-details"},X={class:"item-description"},x={class:"item-price"},T={key:0,class:"includes-drink"},F=["onClick","disabled"],V={key:0,class:"btn-icon"},M={key:1,class:"btn-icon"},z={class:"order-section",ref:"orderSection"},J={key:0,class:"empty-cart"},O={key:1,class:"cart-items"},U={class:"cart-item-details"},W={class:"cart-item-actions"},K=["onClick"],j={class:"quantity-display"},B=["onClick"],H=["onClick"],G={class:"cart-total"},Y={class:"customer-form"},Z={class:"form-row"},ee={class:"form-row"},ae={class:"form-row"},ne={class:"form-row"},oe={class:"payment-methods-selection"},te={class:"payment-options"},re={class:"payment-option"},se={class:"payment-option"},ie={class:"payment-option"},le={class:"form-row"},ce={class:"order-actions"},ue={class:"cart-items-count"},de={key:2,class:"payment-section"},me={class:"payment-methods"},pe={key:0,class:"payment-method qr-payment"},ve={class:"payment-image-container"},fe=["src"],ge={key:1,class:"payment-method nequi-payment"},be={class:"payment-image-container"},ye=["src"],he={key:0,class:"payment-detail"},ke={key:2,class:"payment-method bank-payment"},Ie={class:"payment-detail"},Le={key:3,class:"payment-method other-payment"},Ee={class:"payment-detail"},Ce={class:"reserva-section container mt-5"};function we(e,a,n,we,De,$e){const Pe=(0,o.g2)("ReservaForm");return(0,o.uX)(),(0,o.CE)("div",{class:"shared-menu-container",id:we.menuId},[we.isLoading?((0,o.uX)(),(0,o.CE)("div",i,a[10]||(a[10]=[(0,o.Lk)("div",{class:"spinner"},null,-1),(0,o.Lk)("p",null,"Cargando men√∫...",-1)]))):we.error?((0,o.uX)(),(0,o.CE)("div",l,[(0,o.Lk)("p",null,(0,t.v_)(we.error),1)])):((0,o.uX)(),(0,o.CE)("div",c,[we.menuData?.businessInfo?((0,o.uX)(),(0,o.CE)("div",u,[we.menuData.businessInfo.logo&&we.isValidImage(we.menuData.businessInfo.logo)?((0,o.uX)(),(0,o.CE)("div",d,[(0,o.Lk)("img",{src:we.fixImageFormat(we.menuData.businessInfo.logo),alt:"Logo",class:"business-logo-banner"},null,8,m)])):(0,o.Q3)("",!0),(0,o.Lk)("div",p,[(0,o.Lk)("h1",null,(0,t.v_)(we.menuData.businessInfo.name),1),(0,o.Lk)("p",v,(0,t.v_)(we.menuData.businessInfo.description),1),we.menuData.businessInfo.contact||we.menuData.businessInfo.address?((0,o.uX)(),(0,o.CE)("div",f,[we.menuData.businessInfo.contact?((0,o.uX)(),(0,o.CE)("p",g,[a[11]||(a[11]=(0,o.Lk)("strong",null,"Contacto:",-1)),(0,o.eW)(" "+(0,t.v_)(we.menuData.businessInfo.contact),1)])):(0,o.Q3)("",!0),we.menuData.businessInfo.address?((0,o.uX)(),(0,o.CE)("p",b,[a[12]||(a[12]=(0,o.Lk)("strong",null,"Direcci√≥n:",-1)),(0,o.eW)(" "+(0,t.v_)(we.menuData.businessInfo.address),1)])):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0)])])):(0,o.Q3)("",!0),(0,o.Lk)("div",null,[(0,o.Lk)("div",y,[a[13]||(a[13]=(0,o.Lk)("h2",null,"Nuestro Men√∫",-1)),(0,o.Lk)("div",h,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(we.regularItems,((e,a)=>((0,o.uX)(),(0,o.CE)("div",{key:a,class:"menu-item"},[(0,o.Lk)("div",k,[e.image&&we.isValidImage(e.image)?((0,o.uX)(),(0,o.CE)("img",{key:0,src:we.fixImageFormat(e.image),alt:"Imagen del producto",class:"item-image"},null,8,I)):((0,o.uX)(),(0,o.CE)("img",L))]),(0,o.Lk)("div",E,[(0,o.Lk)("h3",null,(0,t.v_)(e.name),1),(0,o.Lk)("p",C,(0,t.v_)(e.description),1),(0,o.Lk)("p",w,"$"+(0,t.v_)(we.formatPrice(e.price)),1),e.includesDrink?((0,o.uX)(),(0,o.CE)("p",D,"Incluye refresco")):(0,o.Q3)("",!0),(0,o.Lk)("button",{onClick:a=>we.addToCart(e),class:(0,t.C4)(["add-to-cart-btn",{"disabled-btn":!e.realAvailability||e.realAvailability<=0}]),disabled:!e.realAvailability||e.realAvailability<=0},[!e.realAvailability||e.realAvailability<=0?((0,o.uX)(),(0,o.CE)("span",P,"‚ùå")):((0,o.uX)(),(0,o.CE)("span",N,"üõí")),(0,o.eW)(" "+(0,t.v_)(!e.realAvailability||e.realAvailability<=0?"No disponible":"A√±adir al pedido"),1)],10,$)])])))),128))])]),we.specialItems.length>0?((0,o.uX)(),(0,o.CE)("div",q,[a[14]||(a[14]=(0,o.Lk)("h2",null,"Platos Especiales",-1)),(0,o.Lk)("div",S,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(we.specialItems,((e,a)=>((0,o.uX)(),(0,o.CE)("div",{key:a,class:"menu-item special-item"},[(0,o.Lk)("div",R,[e.image&&we.isValidImage(e.image)?((0,o.uX)(),(0,o.CE)("img",{key:0,src:we.fixImageFormat(e.image),alt:"Imagen del producto",class:"item-image"},null,8,A)):((0,o.uX)(),(0,o.CE)("img",Q))]),(0,o.Lk)("div",_,[(0,o.Lk)("h3",null,(0,t.v_)(e.name),1),(0,o.Lk)("p",X,(0,t.v_)(e.description),1),(0,o.Lk)("p",x,"$"+(0,t.v_)(we.formatPrice(e.price)),1),e.includesDrink?((0,o.uX)(),(0,o.CE)("p",T,"Incluye refresco")):(0,o.Q3)("",!0),(0,o.Lk)("button",{onClick:a=>we.addToCart(e),class:(0,t.C4)(["add-to-cart-btn special-button",{"disabled-btn":!e.realAvailability||e.realAvailability<=0}]),disabled:!e.realAvailability||e.realAvailability<=0},[!e.realAvailability||e.realAvailability<=0?((0,o.uX)(),(0,o.CE)("span",V,"‚ùå")):((0,o.uX)(),(0,o.CE)("span",M,"üõí")),(0,o.eW)(" "+(0,t.v_)(!e.realAvailability||e.realAvailability<=0?"No disponible":"A√±adir al pedido"),1)],10,F)])])))),128))])])):(0,o.Q3)("",!0),(0,o.Lk)("div",z,[a[23]||(a[23]=(0,o.Lk)("h2",null,"Tu Pedido",-1)),0===we.cartItems.length?((0,o.uX)(),(0,o.CE)("div",J,a[15]||(a[15]=[(0,o.Lk)("p",null,"Tu pedido est√° vac√≠o",-1),(0,o.Lk)("p",{class:"empty-cart-message"},"A√±ade productos del men√∫ para comenzar tu pedido",-1)]))):((0,o.uX)(),(0,o.CE)("div",O,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(we.cartItems,((e,n)=>((0,o.uX)(),(0,o.CE)("div",{key:n,class:"cart-item"},[(0,o.Lk)("div",U,[(0,o.Lk)("h3",null,(0,t.v_)(e.name),1),(0,o.Lk)("p",null,"$"+(0,t.v_)(we.formatPrice(e.price))+" x "+(0,t.v_)(e.quantity),1)]),(0,o.Lk)("div",W,[(0,o.Lk)("button",{onClick:e=>we.decreaseQuantity(n),class:"quantity-btn"},"-",8,K),(0,o.Lk)("span",j,(0,t.v_)(e.quantity),1),(0,o.Lk)("button",{onClick:e=>we.increaseQuantity(n),class:"quantity-btn"},"+",8,B),(0,o.Lk)("button",{onClick:e=>we.removeFromCart(n),class:"remove-btn"},a[16]||(a[16]=[(0,o.Lk)("span",{class:"btn-icon"},"üóëÔ∏è",-1)]),8,H)])])))),128)),(0,o.Lk)("div",G,[(0,o.Lk)("h3",null,"Total: $"+(0,t.v_)(we.formatPrice(we.cartTotal)),1),(0,o.Lk)("div",Y,[a[21]||(a[21]=(0,o.Lk)("h4",null,"Datos del Cliente",-1)),(0,o.Lk)("div",Z,[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>we.customerInfo.name=e),placeholder:"Nombres completos",class:"form-input"},null,512),[[r.Jo,we.customerInfo.name]])]),(0,o.Lk)("div",ee,[(0,o.bo)((0,o.Lk)("input",{type:"tel","onUpdate:modelValue":a[1]||(a[1]=e=>we.customerInfo.phone=e),placeholder:"Tel√©fono",class:"form-input"},null,512),[[r.Jo,we.customerInfo.phone]])]),(0,o.Lk)("div",ae,[(0,o.bo)((0,o.Lk)("input",{type:"email","onUpdate:modelValue":a[2]||(a[2]=e=>we.customerInfo.email=e),placeholder:"Correo electr√≥nico",class:"form-input"},null,512),[[r.Jo,we.customerInfo.email]])]),(0,o.Lk)("div",ne,[(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=e=>we.customerInfo.address=e),placeholder:"Direcci√≥n de entrega",class:"form-input"},null,512),[[r.Jo,we.customerInfo.address]])]),(0,o.Lk)("div",oe,[a[20]||(a[20]=(0,o.Lk)("h4",null,"Forma de Pago",-1)),(0,o.Lk)("div",te,[(0,o.Lk)("label",re,[(0,o.bo)((0,o.Lk)("input",{type:"radio","onUpdate:modelValue":a[4]||(a[4]=e=>we.selectedPaymentMethod=e),value:"qr",name:"paymentMethod"},null,512),[[r.XL,we.selectedPaymentMethod]]),a[17]||(a[17]=(0,o.Lk)("span",{class:"payment-option-text"},"QR",-1))]),(0,o.Lk)("label",se,[(0,o.bo)((0,o.Lk)("input",{type:"radio","onUpdate:modelValue":a[5]||(a[5]=e=>we.selectedPaymentMethod=e),value:"nequi",name:"paymentMethod"},null,512),[[r.XL,we.selectedPaymentMethod]]),a[18]||(a[18]=(0,o.Lk)("span",{class:"payment-option-text"},"Nequi",-1))]),(0,o.Lk)("label",ie,[(0,o.bo)((0,o.Lk)("input",{type:"radio","onUpdate:modelValue":a[6]||(a[6]=e=>we.selectedPaymentMethod=e),value:"cash",name:"paymentMethod"},null,512),[[r.XL,we.selectedPaymentMethod]]),a[19]||(a[19]=(0,o.Lk)("span",{class:"payment-option-text"},"Contra entrega",-1))])])]),(0,o.Lk)("div",le,[(0,o.bo)((0,o.Lk)("textarea",{"onUpdate:modelValue":a[7]||(a[7]=e=>we.additionalMessage=e),placeholder:"Mensaje o instrucciones adicionales",class:"form-textarea"},null,512),[[r.Jo,we.additionalMessage]])])]),(0,o.Lk)("div",ce,[(0,o.Lk)("button",{onClick:a[8]||(a[8]=(...e)=>we.completeOrder&&we.completeOrder(...e)),class:"complete-order-btn"},a[22]||(a[22]=[(0,o.Lk)("span",{class:"btn-icon"},"üì±",-1),(0,o.eW)(" Enviar por WhatsApp ")]))])])]))],512),we.cartItems.length>0?((0,o.uX)(),(0,o.CE)("div",{key:1,class:"floating-cart-button",onClick:a[9]||(a[9]=(...e)=>we.scrollToOrder&&we.scrollToOrder(...e))},[(0,o.Lk)("span",ue,(0,t.v_)(we.totalItems),1),a[24]||(a[24]=(0,o.Lk)("span",null,"Ver Pedido",-1))])):(0,o.Q3)("",!0),we.hasPaymentInfo?((0,o.uX)(),(0,o.CE)("div",de,[a[31]||(a[31]=(0,o.Lk)("h2",null,"Forma de Pago",-1)),(0,o.Lk)("div",me,[we.menuData?.businessInfo?.paymentInfo?.qrImage?((0,o.uX)(),(0,o.CE)("div",pe,[(0,o.Lk)("h3",null,(0,t.v_)(we.menuData?.businessInfo?.paymentInfo?.qrTitle||"Escanear para pagar"),1),(0,o.Lk)("div",ve,[we.menuData?.businessInfo?.paymentInfo?.qrImage&&we.isValidImage(we.menuData?.businessInfo?.paymentInfo?.qrImage)?((0,o.uX)(),(0,o.CE)("img",{key:0,src:we.fixImageFormat(we.menuData?.businessInfo?.paymentInfo?.qrImage),alt:"QR de Pago",class:"payment-image"},null,8,fe)):(0,o.Q3)("",!0)])])):(0,o.Q3)("",!0),we.menuData?.businessInfo?.paymentInfo?.nequiNumber||we.menuData?.businessInfo?.paymentInfo?.nequiImage?((0,o.uX)(),(0,o.CE)("div",ge,[a[26]||(a[26]=(0,o.Lk)("h3",null,"Pago con Nequi",-1)),(0,o.Lk)("div",be,[we.menuData?.businessInfo?.paymentInfo?.nequiImage&&we.isValidImage(we.menuData?.businessInfo?.paymentInfo?.nequiImage)?((0,o.uX)(),(0,o.CE)("img",{key:0,src:we.fixImageFormat(we.menuData?.businessInfo?.paymentInfo?.nequiImage),alt:"Nequi",class:"payment-image"},null,8,ye)):(0,o.Q3)("",!0)]),we.menuData?.businessInfo?.paymentInfo?.nequiNumber?((0,o.uX)(),(0,o.CE)("p",he,[a[25]||(a[25]=(0,o.Lk)("strong",null,"N√∫mero:",-1)),(0,o.eW)(" "+(0,t.v_)(we.menuData?.businessInfo?.paymentInfo?.nequiNumber),1)])):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0),we.menuData?.businessInfo?.paymentInfo?.bankInfo?((0,o.uX)(),(0,o.CE)("div",ke,[a[28]||(a[28]=(0,o.Lk)("h3",null,"Pago Bancario",-1)),(0,o.Lk)("p",Ie,[a[27]||(a[27]=(0,o.Lk)("strong",null,"Informaci√≥n Bancaria:",-1)),(0,o.eW)(" "+(0,t.v_)(we.menuData?.businessInfo?.paymentInfo?.bankInfo),1)])])):(0,o.Q3)("",!0),we.menuData?.businessInfo?.paymentInfo?.otherPaymentMethods?((0,o.uX)(),(0,o.CE)("div",Le,[a[30]||(a[30]=(0,o.Lk)("h3",null,"Otras Formas de Pago",-1)),(0,o.Lk)("p",Ee,[a[29]||(a[29]=(0,o.Lk)("strong",null,"M√©todos Adicionales:",-1)),(0,o.eW)(" "+(0,t.v_)(we.menuData?.businessInfo?.paymentInfo?.otherPaymentMethods),1)])])):(0,o.Q3)("",!0)])])):(0,o.Q3)("",!0),(0,o.Lk)("div",Ce,[a[32]||(a[32]=(0,o.Lk)("h3",{class:"text-center mb-4"},"¬øQuieres hacer una reserva?",-1)),(0,o.bF)(Pe)]),we.toast.visible?((0,o.uX)(),(0,o.CE)("div",{key:3,class:(0,t.C4)(["toast-notification",we.toast.type])},(0,t.v_)(we.toast.message),3)):(0,o.Q3)("",!0)])]))],8,s)}n(4114),n(8111),n(2489),n(116),n(7588),n(1701),n(8237);var De=n(144),$e=n(1387),Pe=n(5226),Ne=n(6429),qe=n(8982);const Se={class:"reservas-section"},Re={key:0,class:"reserva-form-container"},Ae={class:"form-group"},Qe={class:"form-group"},_e={class:"form-group"},Xe={class:"form-group"},xe={class:"form-group"},Te={class:"form-group"},Fe={class:"form-group"},Ve={class:"form-group"},Me={class:"form-group"},ze={class:"form-actions"},Je=["disabled"],Oe=["disabled"];function Ue(e,a,n,s,i,l){return(0,o.uX)(),(0,o.CE)("div",Se,[(0,o.Lk)("button",{onClick:a[0]||(a[0]=(...e)=>s.toggleReservaForm&&s.toggleReservaForm(...e)),class:"toggle-reserva-button"},(0,t.v_)(s.showReservaForm?"Ocultar Formulario de Reserva":"Hacer una Reserva"),1),s.showReservaForm?((0,o.uX)(),(0,o.CE)("div",Re,[a[21]||(a[21]=(0,o.Lk)("h3",null,"Reserva tu Mesa",-1)),(0,o.Lk)("form",{onSubmit:a[11]||(a[11]=(0,r.D$)(((...e)=>s.processReservation&&s.processReservation(...e)),["prevent"])),class:"reserva-form"},[(0,o.Lk)("div",Ae,[a[12]||(a[12]=(0,o.Lk)("label",{for:"fullName"},"Nombre Completo *",-1)),(0,o.bo)((0,o.Lk)("input",{type:"text",id:"fullName","onUpdate:modelValue":a[1]||(a[1]=e=>s.reservationData.fullName=e),placeholder:"Ingresa tu nombre completo",required:""},null,512),[[r.Jo,s.reservationData.fullName]])]),(0,o.Lk)("div",Qe,[a[13]||(a[13]=(0,o.Lk)("label",{for:"mobilePhone"},"Tel√©fono M√≥vil *",-1)),(0,o.bo)((0,o.Lk)("input",{type:"tel",id:"mobilePhone","onUpdate:modelValue":a[2]||(a[2]=e=>s.reservationData.mobilePhone=e),placeholder:"Ej. 612345678",required:""},null,512),[[r.Jo,s.reservationData.mobilePhone]])]),(0,o.Lk)("div",_e,[a[14]||(a[14]=(0,o.Lk)("label",{for:"landlinePhone"},"Tel√©fono Fijo",-1)),(0,o.bo)((0,o.Lk)("input",{type:"tel",id:"landlinePhone","onUpdate:modelValue":a[3]||(a[3]=e=>s.reservationData.landlinePhone=e),placeholder:"Opcional"},null,512),[[r.Jo,s.reservationData.landlinePhone]])]),(0,o.Lk)("div",Xe,[a[15]||(a[15]=(0,o.Lk)("label",{for:"address"},"Direcci√≥n",-1)),(0,o.bo)((0,o.Lk)("input",{type:"text",id:"address","onUpdate:modelValue":a[4]||(a[4]=e=>s.reservationData.address=e),placeholder:"Tu direcci√≥n (opcional)"},null,512),[[r.Jo,s.reservationData.address]])]),(0,o.Lk)("div",xe,[a[16]||(a[16]=(0,o.Lk)("label",{for:"email"},"Correo Electr√≥nico",-1)),(0,o.bo)((0,o.Lk)("input",{type:"email",id:"email","onUpdate:modelValue":a[5]||(a[5]=e=>s.reservationData.email=e),placeholder:"ejemplo@correo.com (opcional)"},null,512),[[r.Jo,s.reservationData.email]])]),(0,o.Lk)("div",Te,[a[17]||(a[17]=(0,o.Lk)("label",{for:"reservationDate"},"Fecha de Reserva *",-1)),(0,o.bo)((0,o.Lk)("input",{type:"date",id:"reservationDate","onUpdate:modelValue":a[6]||(a[6]=e=>s.reservationData.date=e),required:""},null,512),[[r.Jo,s.reservationData.date]])]),(0,o.Lk)("div",Fe,[a[18]||(a[18]=(0,o.Lk)("label",{for:"reservationTime"},"Hora de Reserva *",-1)),(0,o.bo)((0,o.Lk)("input",{type:"time",id:"reservationTime","onUpdate:modelValue":a[7]||(a[7]=e=>s.reservationData.time=e),required:""},null,512),[[r.Jo,s.reservationData.time]])]),(0,o.Lk)("div",Ve,[a[19]||(a[19]=(0,o.Lk)("label",{for:"peopleCount"},"N√∫mero de Personas *",-1)),(0,o.bo)((0,o.Lk)("input",{type:"number",id:"peopleCount","onUpdate:modelValue":a[8]||(a[8]=e=>s.reservationData.peopleCount=e),min:"1",max:"20",required:""},null,512),[[r.Jo,s.reservationData.peopleCount]])]),(0,o.Lk)("div",Me,[a[20]||(a[20]=(0,o.Lk)("label",{for:"specialNotes"},"Notas Adicionales",-1)),(0,o.bo)((0,o.Lk)("textarea",{id:"specialNotes","onUpdate:modelValue":a[9]||(a[9]=e=>s.reservationData.notes=e),placeholder:"Instrucciones especiales, preferencias, etc.",rows:"3"},null,512),[[r.Jo,s.reservationData.notes]])]),(0,o.Lk)("div",ze,[(0,o.Lk)("button",{type:"submit",class:"submit-button",disabled:s.isProcessing},(0,t.v_)(s.isProcessing?"Procesando...":"Reservar Mesa"),9,Je),(0,o.Lk)("button",{type:"button",class:"clear-button",onClick:a[10]||(a[10]=(...e)=>s.clearForm&&s.clearForm(...e)),disabled:s.isProcessing}," Limpiar ",8,Oe)])],32)])):(0,o.Q3)("",!0),s.toast.show?((0,o.uX)(),(0,o.CE)("div",{key:1,class:(0,t.C4)(["toast-notification",s.toast.type])},(0,t.v_)(s.toast.message),3)):(0,o.Q3)("",!0)])}var We=n(7051),Ke={name:"ReservaForm",setup(){console.log("ReservaForm montado");const e=(0,De.KR)(!1),a=(0,De.Kh)({fullName:"",mobilePhone:"",landlinePhone:"",address:"",email:"",date:"",time:"",peopleCount:1,notes:""}),n=(0,De.KR)(!1),o=(0,De.Kh)({show:!1,message:"",type:"info"}),t=()=>{e.value=!e.value},r=(e,a="info")=>{o.message=e,o.type=a,o.show=!0,setTimeout((()=>{o.show=!1}),5e3)},s=()=>a.fullName.trim()?a.mobilePhone.trim()?a.date?a.time?!(!a.peopleCount||a.peopleCount<1)||(r("Por favor, indica el n√∫mero de personas","error"),!1):(r("Por favor, selecciona una hora para la reserva","error"),!1):(r("Por favor, selecciona una fecha para la reserva","error"),!1):(r("Por favor, ingresa un n√∫mero de tel√©fono m√≥vil","error"),!1):(r("Por favor, ingresa tu nombre completo","error"),!1),i=async()=>{if(s())try{n.value=!0;const e={fullName:a.fullName,mobilePhone:a.mobilePhone,landlinePhone:a.landlinePhone||"",email:a.email||"",address:a.address||"",date:a.date,time:a.time,peopleCount:a.peopleCount,notes:a.notes||"",status:"pending",source:"menu"};console.log("Enviando reserva al sistema:",e);const o={nombre:a.fullName,telefono:a.mobilePhone,email:a.email||"",fecha:a.date,hora:a.time,personas:a.peopleCount,notas:`Reserva desde men√∫ compartido: ${a.notes||"Sin notas adicionales"}`};console.log("Enviando reserva como mensaje de WhatsApp:",o);const t=await(0,Ne.sb)(o);if(console.log("Resultado de env√≠o como WhatsApp:",t),!t.success)throw new Error(t.error||"Error al guardar la reserva");const s=`\nüìÖ *NUEVA RESERVA DE MESA*\n---------------------------\nüë§ *Nombre:* ${a.fullName}\nüì± *Tel√©fono m√≥vil:* ${a.mobilePhone}\n${a.landlinePhone?`‚òéÔ∏è *Tel√©fono fijo:* ${a.landlinePhone}`:""}\n${a.email?`‚úâÔ∏è *Email:* ${a.email}`:""}\nüìÜ *Fecha:* ${a.date}\n‚è∞ *Hora:* ${a.time}\nüë• *Personas:* ${a.peopleCount}\n${a.notes?`üìù *Notas:* ${a.notes}`:""}\n---------------------------\nüåê Esta reserva fue realizada a trav√©s del sistema de reservas online.\n`,i=encodeURIComponent(s),c=`https://api.whatsapp.com/send?text=${i}`;window.open(c,"_blank"),r("¬°Reserva enviada correctamente! Tambi√©n puedes confirmarla por WhatsApp.","success"),l()}catch(e){console.error("Error al procesar la reserva:",e),r("Hubo un error al procesar tu reserva. Por favor, intenta nuevamente.","error")}finally{n.value=!1}},l=()=>{a.fullName="",a.mobilePhone="",a.landlinePhone="",a.address="",a.email="",a.date="",a.time="",a.peopleCount=1,a.notes=""};return{showReservaForm:e,reservationData:a,isProcessing:n,toast:o,toggleReservaForm:t,processReservation:i,clearForm:l}}},je=n(1241);const Be=(0,je.A)(Ke,[["render",Ue],["__scopeId","data-v-732333be"]]);var He=Be,Ge=n(2949),Ye={name:"SharedMenuView",components:{ReservaForm:He},props:{id:{type:String,default:""}},setup(e){const a=(0,$e.lq)(),t=(0,o.EW)((()=>e.id||a.params.id)),r=(0,De.KR)({items:[],businessInfo:null}),s=(0,De.KR)(!0),i=(0,De.KR)(null),l=(0,De.KR)([]),c=((0,De.KR)(null),(0,De.KR)(!1)),u=(0,De.KR)(null);console.log("SharedMenuView montado, ID del men√∫:",a.params.id);const d=(0,De.KR)({visible:!1,message:"",type:"success",timeoutId:null});(0,o.sV)((()=>{p(),We.A.on("business-info-updated",m),(0,Ge.D2)(!0)})),(0,o.hi)((()=>{We.A.off("business-info-updated",m),(0,Ge.Vg)(),d.value.timeoutId&&clearTimeout(d.value.timeoutId)}));const m=e=>{console.log("Nueva informaci√≥n del negocio recibida en SharedMenuView:",e),e&&(r.value.businessInfo={...e},u.value=Date.now(),h("Informaci√≥n del negocio actualizada","info"))};async function p(){try{if(s.value=!0,i.value=null,console.log("Cargando men√∫ con ID:",a.params.id),!a.params.id)return i.value="ID de men√∫ no especificado",void(s.value=!1);const d=localStorage.getItem(`cart_${a.params.id}`);if(d)try{l.value=JSON.parse(d),console.log("Carrito recuperado de localStorage:",l.value)}catch(e){console.error("Error al parsear carrito de localStorage:",e)}try{const e=await(0,Pe.rJ)(a.params.id);if(!e||!e.items)throw new Error("Datos de men√∫ no v√°lidos");r.value.items=e.items;try{e.businessInfo&&(r.value.businessInfo=e.businessInfo,console.log("Informaci√≥n del negocio cargada del men√∫:",e.businessInfo));const n=await(0,Ge.xr)(!1,a.params.id);n&&Object.keys(n).length>0&&(r.value.businessInfo={...r.value.businessInfo||{},...n},u.value=Date.now(),console.log("Informaci√≥n adicional del negocio cargada del backend con ID:",a.params.id))}catch(n){console.warn("No se pudo cargar informaci√≥n del negocio desde backend:",n),e.businessInfo&&(r.value.businessInfo=e.businessInfo,console.log("Informaci√≥n del negocio cargada del men√∫ como respaldo:",e.businessInfo))}console.log("Men√∫ cargado con √©xito:",r.value),r.value.items.forEach((e=>{e.availableQuantity=void 0!==e.availableQuantity?Number(e.availableQuantity):0,e.realAvailability=e.availableQuantity})),q();try{localStorage.setItem(`menu_${a.params.id}`,JSON.stringify(r.value))}catch(o){console.warn("No se pudo guardar el men√∫ en localStorage:",o)}}catch(t){console.error("Error al cargar el men√∫ desde la API:",t);try{const e=localStorage.getItem(`menu_${a.params.id}`);if(!e)throw new Error("No se encontr√≥ el men√∫ en cach√©");if(r.value=JSON.parse(e),console.log("Men√∫ recuperado desde localStorage:",r.value),!r.value||!r.value.items)throw new Error("Datos de men√∫ en cach√© no v√°lidos");r.value.items.forEach((e=>{e.availableQuantity=void 0!==e.availableQuantity?Number(e.availableQuantity):0,e.realAvailability=e.availableQuantity})),q(),h("Usando datos almacenados localmente. Algunas funciones pueden estar limitadas.","warning")}catch(c){console.error("Error al recuperar men√∫ desde cach√©:",c),i.value="No se encontr√≥ el men√∫ solicitado. Por favor, verifica el enlace o intenta m√°s tarde."}}}catch(e){console.error("Error general al cargar el men√∫:",e),i.value=e.message||"Error al cargar el men√∫"}finally{s.value=!1}}const v=(0,o.EW)((()=>{const e=r.value?.businessInfo?.paymentInfo;return!!e&&!!(e.qrImage&&S(e.qrImage)||e.qrTitle||e.nequiNumber||e.nequiImage&&S(e.nequiImage)||e.bankInfo||e.otherPaymentMethods)})),f=(0,o.EW)((()=>l.value.reduce(((e,a)=>e+a.quantity),0))),g=(0,o.EW)((()=>l.value.reduce(((e,a)=>e+a.price*a.quantity),0)));function b(e){if(isNaN(Number(e)))return"0,00";const a=Number(e).toFixed(2),[n,o]=a.split("."),t=n.replace(/\B(?=(\d{3})+(?!\d))/g,".");return`${t},${o}`}async function y(e){if(Number(e.availableQuantity)<=0)return void h(`Lo sentimos, "${e.name}" no est√° disponible actualmente. Intente m√°s tarde por favor.`,"error");const a=await P(e);if(!a)return;const n=l.value.find((a=>e.id&&a.id?a.id===e.id:a.name===e.name));n?n.quantity++:l.value.push({id:e.id||Date.now().toString(),name:e.name,price:e.price,quantity:1,availableQuantity:e.availableQuantity||0}),k(),q(),h(`${e.name} a√±adido al carrito`,"success")}function h(e,a="success",n=5e3){console.log(`[Toast] Mostrando notificaci√≥n: ${e} (${a})`),d.value.timeoutId&&clearTimeout(d.value.timeoutId),d.value.message=e,d.value.type=a,d.value.visible=!0,console.log(`[Toast] Estado: visible=${d.value.visible}, message=${d.value.message}`),d.value.timeoutId=setTimeout((()=>{console.log(`[Toast] Ocultando notificaci√≥n despu√©s de ${n}ms`),d.value.visible=!1}),n)}function k(){try{localStorage.setItem(`cart_${a.params.id}`,JSON.stringify(l.value))}catch(e){console.error("Error al guardar carrito en localStorage:",e)}}function I(e){const a=l.value[e],n=r.value.items?.find((e=>e.id===a.id));if(n){const e=n.availableQuantity||0;if(a.quantity>=e)return void h(`No hay m√°s unidades disponibles de "${a.name}"`,"warning")}a.quantity++,k(),q()}function L(e){l.value[e].quantity>1?(l.value[e].quantity--,k(),q()):E(e)}function E(e){l.value.splice(e,1),k(),q()}async function C(){try{if(0===l.value.length)return void h("No hay √≠tems en el pedido","error");if(!A.value.name||!A.value.phone)return void h("Por favor complete su nombre y tel√©fono","error");c.value=!0,await N(),D(),h("¬°Pedido completado! Gracias por tu compra.","success"),setTimeout((()=>{l.value=[],localStorage.removeItem(`cart_${a.params.id}`),A.value={name:"",phone:"",email:"",address:""},_.value="",c.value=!1}),2e3)}catch(i){console.error("Error al completar el pedido:",i),h("Error al procesar el pedido","error"),c.value=!1}}function w(){0!==l.value.length?A.value.name&&A.value.phone?(D(),h("Pedido compartido por WhatsApp","success")):h("Por favor complete su nombre y tel√©fono","error"):h("No hay √≠tems en el pedido","error")}function D(){let e=`üõí *Pedido de ${A.value.name}*\n\n`;e+="üì¶ *Productos:*\n",l.value.forEach((a=>{const n=(a.price*a.quantity).toFixed(2);e+=`üçΩÔ∏è ${a.quantity}x ${a.name} = $${b(n)}\n`})),e+=`\nüíµ *Total:* $${b(g.value)}\n`,A.value.phone&&(e+=`üìû *Tel√©fono:* ${A.value.phone}\n`),A.value.email&&(e+=`‚úâÔ∏è *Email:* ${A.value.email}\n`),A.value.address&&(e+=`üìç *Direcci√≥n:* ${A.value.address}\n`),_.value&&(e+=`üìù *Notas adicionales:*\n${_.value}\n`);const a="qr"===Q.value?"C√≥digo QR":"nequi"===Q.value?"Nequi":"Contra entrega";e+=`\nüí≥ *Forma de pago:* ${a}`;const n=encodeURIComponent(e),o=`https://api.whatsapp.com/send?text=${n}`;window.open(o,"_blank")}function $(){const e=document.querySelector(".order-section");e&&e.scrollIntoView({behavior:"smooth"})}async function P(e){const a=Number(e.availableQuantity)||0;if(a<=0)return h(`Lo sentimos, "${e.name}" no est√° disponible actualmente. Intente m√°s tarde por favor.`,"error"),!1;const n=l.value.find((a=>a.id===e.id)),o=n?n.quantity:0,t=a-o;return t<=0?(h(`No hay m√°s unidades disponibles de "${e.name}"`,"warning"),!1):(t<=5&&h(`¬°Solo quedan ${t} unidades de "${e.name}"!`,"warning"),!0)}async function N(){try{if(!l.value||0===l.value.length)return void console.warn("Intentando actualizar inventario con carrito vac√≠o");console.log(`Iniciando actualizaci√≥n de inventario para ${l.value.length} productos...`);const t=await(0,qe.gL)();if(!t||!Array.isArray(t))return console.error("No se pudo obtener el men√∫ actual"),!1;const r=JSON.parse(JSON.stringify(l.value)),s=[];let i=!1;const{getSoldItems:c,saveSoldItems:u}=await Promise.resolve().then(n.bind(n,8982));let d=[];try{d=await c()||[],Array.isArray(d)||(d=[]),console.log("Lista de elementos vendidos obtenida:",d.length)}catch(e){console.warn("Error al obtener elementos vendidos:",e),d=[]}for(let e=0;e<r.length;e++){const n=r[e];console.log(`Procesando item ${e+1}/${r.length}: ${n.name} (ID: ${n.id})`);try{const e=t.find((e=>e.id===n.id));if(!e){console.warn(`Elemento no encontrado en el men√∫: ${n.name} (ID: ${n.id})`),s.push({name:n.name,success:!1,error:"Elemento no encontrado en el men√∫"});continue}const a=parseInt(Number(e.availableQuantity||0),10),o=parseInt(Number(n.quantity||0),10);if(isNaN(a)||isNaN(o)){const a=`Cantidades inv√°lidas para ${n.name}: disponible=${e.availableQuantity}, vendido=${n.quantity}`;console.error(a),s.push({name:n.name,success:!1,error:a}),i=!0;continue}const r=Math.max(0,a-o);console.log(`Actualizando ${n.name}: ${a} - ${o} = ${r} (currentQuantity tipo: ${typeof a}, soldQuantity tipo: ${typeof o})`);const l=await(0,qe.eq)(e.id,r);if(s.push({name:n.name,oldQuantity:a,soldQuantity:o,newQuantity:r,success:l,error:l?null:"Error al actualizar disponibilidad"}),l){const a=(new Date).toISOString(),t=d.find((e=>e.name===n.name));t?(t.quantity+=o,t.date=a):d.push({name:n.name,quantity:o,price:n.price,includesDrink:e.includesDrink||!1,date:a}),console.log(`Elemento registrado en lista de vendidos: ${n.name} x${o}`)}else i=!0}catch(a){console.error(`Error procesando ${n.name}:`,a),s.push({name:n.name,success:!1,error:a.message||"Error desconocido"}),i=!0}}try{await u(d),console.log(`Lista de elementos vendidos actualizada con ${d.length} elementos`)}catch(o){console.error("Error al guardar elementos vendidos:",o)}const m=s.filter((e=>e.success)).length;if(console.log(`Actualizaci√≥n de inventario completada. √âxitos: ${m}/${r.length}`),console.log("Detalles de actualizaci√≥n de inventario:",s),i){const e=s.filter((e=>!e.success)).map((e=>e.name)).join(", ");console.warn(`Algunos productos no se pudieron actualizar: ${e}`)}return m>0}catch(i){return console.error("Error general al actualizar inventario:",i),!1}}function q(){r.value?.items&&r.value.items.forEach((e=>{const a=l.value.find((a=>a.id===e.id)),n=a?a.quantity:0,o=Number(e.availableQuantity)||0;e.realAvailability=o-n,console.log(`Disponibilidad actualizada para ${e.name}: ${e.realAvailability} unidades (base: ${o}, carrito: ${n})`)}))}function S(e){return!!e&&(!(!e.startsWith("http://")&&!e.startsWith("https://"))||!!e.startsWith("data:image/"))}function R(e){return e?S(e)?e:e.includes("/9j/")&&!e.startsWith("data:image/")?`data:image/jpeg;base64,${e}`:"":""}const A=(0,De.KR)({name:"",phone:"",email:"",address:""}),Q=(0,De.KR)("cash"),_=(0,De.KR)(""),X=(0,o.EW)((()=>{if(!r.value||!r.value.items)return[];const e=r.value.items.filter((e=>!e.isSpecial));return console.log("Platos regulares:",e.length,e.map((e=>e.name))),e})),x=(0,o.EW)((()=>{if(!r.value||!r.value.items)return[];const e=r.value.items.filter((e=>!0===e.isSpecial));return console.log("Platos especiales:",e.length,e.map((e=>e.name))),e})),T=(0,De.KR)(!1),F=(0,De.KR)(!1),V=(0,De.KR)(!1),M=(0,De.KR)(null),z=(0,De.KR)({fullName:"",mobilePhone:"",landlinePhone:"",address:"",email:"",orderDate:J(),reservationDate:"",reservationTime:"",peopleCount:1,additionalNotes:""});function J(){const e=new Date,a=e.getFullYear(),n=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${a}-${n}-${o}`}async function O(){F.value=!0,V.value=!1,M.value=null;try{const e=await(0,Ne.S1)(z.value);if(!e.success)throw new Error(e.error||"Error al procesar la reserva");V.value=!0,h("¬°Reserva enviada con √©xito! Recibir√° un correo de confirmaci√≥n en breve.","success"),console.log("Enviando correo de confirmaci√≥n a:",z.value.email),setTimeout((()=>{W(),T.value=!1}),3e3)}catch(i){console.error("Error al enviar la reserva:",i),M.value="Ocurri√≥ un error al procesar su reserva. Por favor, intente nuevamente.",h("Error al procesar la reserva. Por favor, intente nuevamente.","error")}finally{F.value=!1}}function U(){W(),T.value=!1}function W(){z.value.fullName="",z.value.mobilePhone="",z.value.landlinePhone="",z.value.address="",z.value.email="",z.value.orderDate=J(),z.value.reservationDate="",z.value.reservationTime="",z.value.peopleCount=1,z.value.additionalNotes="",V.value=!1,M.value=null}async function K(){try{const e=await(0,Ge.xr)(!0,a.params.id);e&&(r.value.businessInfo=e,u.value=Date.now(),h("Informaci√≥n del negocio actualizada","success"))}catch(i){console.error("Error al refrescar informaci√≥n del negocio:",i),h("Error al actualizar informaci√≥n del negocio","error")}}return{menuId:t,isLoading:s,error:i,menuData:r,regularItems:X,specialItems:x,cartItems:l,cartTotal:g,totalItems:f,customerInfo:A,selectedPaymentMethod:Q,additionalMessage:_,addToCart:y,removeFromCart:E,increaseQuantity:I,decreaseQuantity:L,formatPrice:b,completeOrder:C,shareOrderByWhatsApp:w,scrollToOrder:$,isValidImage:S,fixImageFormat:R,hasPaymentInfo:v,showReservationForm:T,reservationData:z,isProcessingReservation:F,reservationSuccess:V,reservationError:M,submitReservation:O,cancelReservation:U,getCurrentDate:J,toast:d,refreshBusinessInfo:K,lastBusinessInfoUpdate:u}}};const Ze=(0,je.A)(Ye,[["render",we],["__scopeId","data-v-a1d0cc06"]]);var ea=Ze}}]);
//# sourceMappingURL=shared-menu.7f999ff2.js.map