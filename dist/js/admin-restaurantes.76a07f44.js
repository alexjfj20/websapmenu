"use strict";(self["webpackChunkwebsap"]=self["webpackChunkwebsap"]||[]).push([[328],{1929:function(e,r,a){a.r(r),a.d(r,{default:function(){return z}});var t=a(6768),s=a(4232),n=a(5130);const o={class:"admin-restaurantes"},l={key:0,class:"alert alert-info"},c={key:1,class:"alert alert-danger"},u={class:"mb-3"},i={class:"card-header d-flex justify-content-between align-items-center"},d={class:"mb-0"},m=["onClick"],f=["onClick"],g={class:"card-body"},k={class:"row"},p={class:"col-md-6"},b={class:"col-md-6"},v={class:"mb-3"},L={class:"input-group"},E=["value"],y=["onClick"],w=["onClick"],h={key:2,class:"alert alert-warning"},C={class:"modal-dialog",role:"document"},R={class:"modal-content"},_={class:"modal-header"},M={class:"modal-title"},$={class:"modal-body"},D={class:"mb-3"},T={class:"mb-3"},U={class:"mb-3"},x={class:"mb-3"},I={class:"modal-footer"},X={key:3,class:"modal-backdrop fade show"};function A(e,r,a,A,K,S){return(0,t.uX)(),(0,t.CE)("div",o,[r[22]||(r[22]=(0,t.Lk)("h1",null,"Gestión de Restaurantes",-1)),A.loading?((0,t.uX)(),(0,t.CE)("div",l," Cargando restaurantes... ")):(0,t.Q3)("",!0),A.error?((0,t.uX)(),(0,t.CE)("div",c,(0,s.v_)(A.error),1)):(0,t.Q3)("",!0),(0,t.Lk)("div",u,[(0,t.Lk)("button",{class:"btn btn-primary",onClick:r[0]||(r[0]=e=>A.showCreateModal=!0)},r[8]||(r[8]=[(0,t.Lk)("i",{class:"fas fa-plus"},null,-1),(0,t.eW)(" Nuevo Restaurante ")]))]),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(A.restaurantes,(e=>((0,t.uX)(),(0,t.CE)("div",{class:"card mb-4",key:e.id},[(0,t.Lk)("div",i,[(0,t.Lk)("h5",d,(0,s.v_)(e.nombre),1),(0,t.Lk)("div",null,[(0,t.Lk)("button",{class:"btn btn-sm btn-outline-primary me-2",onClick:r=>A.editRestaurante(e)},r[9]||(r[9]=[(0,t.Lk)("i",{class:"fas fa-edit"},null,-1),(0,t.eW)(" Editar ")]),8,m),(0,t.Lk)("button",{class:"btn btn-sm btn-outline-info me-2",onClick:r=>A.regenerateLink(e)},r[10]||(r[10]=[(0,t.Lk)("i",{class:"fas fa-sync"},null,-1),(0,t.eW)(" Regenerar Enlace ")]),8,f)])]),(0,t.Lk)("div",g,[(0,t.Lk)("div",k,[(0,t.Lk)("div",p,[(0,t.Lk)("p",null,[r[11]||(r[11]=(0,t.Lk)("strong",null,"Dirección:",-1)),(0,t.eW)(" "+(0,s.v_)(e.direccion||"No especificada"),1)]),(0,t.Lk)("p",null,[r[12]||(r[12]=(0,t.Lk)("strong",null,"Teléfono:",-1)),(0,t.eW)(" "+(0,s.v_)(e.telefono||"No especificado"),1)]),(0,t.Lk)("p",null,[r[13]||(r[13]=(0,t.Lk)("strong",null,"Descripción:",-1)),(0,t.eW)(" "+(0,s.v_)(e.descripcion||"Sin descripción"),1)])]),(0,t.Lk)("div",b,[(0,t.Lk)("div",v,[r[16]||(r[16]=(0,t.Lk)("strong",null,"Enlace compartido:",-1)),(0,t.Lk)("div",L,[(0,t.Lk)("input",{type:"text",class:"form-control",readonly:"",value:A.getMenuUrl(e.enlace_compartido)},null,8,E),(0,t.Lk)("button",{class:"btn btn-outline-secondary",type:"button",onClick:r=>A.copyToClipboard(A.getMenuUrl(e.enlace_compartido))},r[14]||(r[14]=[(0,t.Lk)("i",{class:"fas fa-copy"},null,-1)]),8,y),(0,t.Lk)("button",{class:"btn btn-outline-success",type:"button",onClick:r=>A.shareViaWhatsApp(e.enlace_compartido)},r[15]||(r[15]=[(0,t.Lk)("i",{class:"fab fa-whatsapp"},null,-1)]),8,w)])])])])])])))),128)),0!==A.restaurantes.length||A.loading?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",h," No tienes restaurantes registrados. Crea uno nuevo para comenzar. ")),(0,t.Lk)("div",{class:(0,s.C4)(["modal fade",{"show d-block":A.showCreateModal||A.showEditModal}]),tabindex:"-1",role:"dialog"},[(0,t.Lk)("div",C,[(0,t.Lk)("div",R,[(0,t.Lk)("div",_,[(0,t.Lk)("h5",M,(0,s.v_)(A.editingRestaurante?"Editar":"Nuevo")+" Restaurante",1),(0,t.Lk)("button",{type:"button",class:"btn-close",onClick:r[1]||(r[1]=(...e)=>A.closeModals&&A.closeModals(...e))})]),(0,t.Lk)("div",$,[(0,t.Lk)("form",{onSubmit:r[7]||(r[7]=(0,n.D$)(((...e)=>A.saveRestaurante&&A.saveRestaurante(...e)),["prevent"]))},[(0,t.Lk)("div",D,[r[17]||(r[17]=(0,t.Lk)("label",{for:"nombre",class:"form-label"},"Nombre *",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",class:"form-control",id:"nombre","onUpdate:modelValue":r[2]||(r[2]=e=>A.formData.nombre=e),required:""},null,512),[[n.Jo,A.formData.nombre]])]),(0,t.Lk)("div",T,[r[18]||(r[18]=(0,t.Lk)("label",{for:"direccion",class:"form-label"},"Dirección",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",class:"form-control",id:"direccion","onUpdate:modelValue":r[3]||(r[3]=e=>A.formData.direccion=e)},null,512),[[n.Jo,A.formData.direccion]])]),(0,t.Lk)("div",U,[r[19]||(r[19]=(0,t.Lk)("label",{for:"telefono",class:"form-label"},"Teléfono",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",class:"form-control",id:"telefono","onUpdate:modelValue":r[4]||(r[4]=e=>A.formData.telefono=e)},null,512),[[n.Jo,A.formData.telefono]])]),(0,t.Lk)("div",x,[r[20]||(r[20]=(0,t.Lk)("label",{for:"descripcion",class:"form-label"},"Descripción",-1)),(0,t.bo)((0,t.Lk)("textarea",{class:"form-control",id:"descripcion","onUpdate:modelValue":r[5]||(r[5]=e=>A.formData.descripcion=e),rows:"3"},null,512),[[n.Jo,A.formData.descripcion]])]),(0,t.Lk)("div",I,[(0,t.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:r[6]||(r[6]=(...e)=>A.closeModals&&A.closeModals(...e))},"Cancelar"),r[21]||(r[21]=(0,t.Lk)("button",{type:"submit",class:"btn btn-primary"},"Guardar",-1))])],32)])])])],2),A.showCreateModal||A.showEditModal?((0,t.uX)(),(0,t.CE)("div",X)):(0,t.Q3)("",!0)])}var K=a(144),S=a(2639),W={name:"AdminRestaurantes",setup(){const e=(0,K.KR)([]),r=(0,K.KR)(!1),a=(0,K.KR)(null),s=(0,K.KR)(!1),n=(0,K.KR)(!1),o=(0,K.KR)(null),l=(0,K.KR)({nombre:"",direccion:"",telefono:"",descripcion:""}),c=async()=>{r.value=!0,a.value=null;try{const r=await(0,S.sl)();r.success?e.value=r.restaurantes:a.value=r.error||"Error al cargar restaurantes"}catch(t){console.error("Error al cargar restaurantes:",t),a.value="Error al cargar restaurantes: "+t.message}finally{r.value=!1}};(0,t.sV)(c);const u=e=>{o.value=e,l.value={nombre:e.nombre,direccion:e.direccion||"",telefono:e.telefono||"",descripcion:e.descripcion||""},n.value=!0},i=async()=>{r.value=!0,a.value=null;try{let e;e=o.value?await(0,S.AY)(o.value.id,l.value):await(0,S.XR)(l.value),e.success?(await c(),k()):a.value=e.error||"Error al guardar restaurante"}catch(e){console.error("Error al guardar restaurante:",e),a.value="Error al guardar restaurante: "+e.message}finally{r.value=!1}},d=async t=>{if(confirm("¿Estás seguro de regenerar el enlace? El enlace anterior dejará de funcionar.")){r.value=!0,a.value=null;try{const r=await(0,S.BL)(t.id);if(r.success){const a=e.value.findIndex((e=>e.id===t.id));-1!==a&&(e.value[a].enlace_compartido=r.enlace_compartido)}else a.value=r.error||"Error al regenerar enlace"}catch(s){console.error("Error al regenerar enlace:",s),a.value="Error al regenerar enlace: "+s.message}finally{r.value=!1}}},m=e=>`${window.location.origin}/menu/${e}`,f=e=>{const r=m(e),a=`¡Hola! Aquí puedes ver nuestro menú: ${r}`,t=`https://wa.me/?text=${encodeURIComponent(a)}`;window.open(t,"_blank")},g=e=>{navigator.clipboard.writeText(e).then((()=>{alert("Enlace copiado al portapapeles")})).catch((e=>{console.error("Error al copiar:",e),a.value="Error al copiar al portapapeles"}))},k=()=>{s.value=!1,n.value=!1,o.value=null,l.value={nombre:"",direccion:"",telefono:"",descripcion:""}};return{restaurantes:e,loading:r,error:a,showCreateModal:s,showEditModal:n,editingRestaurante:o,formData:l,loadRestaurantes:c,editRestaurante:u,saveRestaurante:i,regenerateLink:d,getMenuUrl:m,shareViaWhatsApp:f,copyToClipboard:g,closeModals:k}}},N=a(1241);const V=(0,N.A)(W,[["render",A],["__scopeId","data-v-d97e2b58"]]);var z=V},2639:function(e,r,a){a.d(r,{AY:function(){return l},BL:function(){return c},XR:function(){return o},sl:function(){return s}});var t=a(133);async function s(){try{const e=localStorage.getItem("token");e&&t["default"].setToken(e);const r=await t["default"].get("/restaurantes");if(r&&r.success)return{success:!0,restaurantes:r.restaurantes||[]};throw new Error(r.message||"Error al obtener restaurantes")}catch(e){return console.error("Error al obtener restaurantes:",e),{success:!1,error:e.message||"Error al obtener restaurantes",restaurantes:[]}}}async function n(e){try{const r=localStorage.getItem("token");r&&t["default"].setToken(r);const a=await t["default"].get(`/restaurantes/${e}`);if(a&&a.success)return{success:!0,restaurante:a.restaurante};throw new Error(a.message||"Error al obtener restaurante")}catch(r){return console.error(`Error al obtener restaurante ${e}:`,r),{success:!1,error:r.message||"Error al obtener restaurante"}}}async function o(e){try{const r=localStorage.getItem("token");r&&t["default"].setToken(r);const a=await t["default"].post("/restaurantes",e);if(a&&a.success)return{success:!0,restaurante:a.restaurante,message:a.message||"Restaurante creado correctamente"};throw new Error(a.message||"Error al crear restaurante")}catch(r){return console.error("Error al crear restaurante:",r),{success:!1,error:r.message||"Error al crear restaurante"}}}async function l(e,r){try{const a=localStorage.getItem("token");a&&t["default"].setToken(a);const s=await t["default"].put(`/restaurantes/${e}`,r);if(s&&s.success)return{success:!0,restaurante:s.restaurante,message:s.message||"Restaurante actualizado correctamente"};throw new Error(s.message||"Error al actualizar restaurante")}catch(a){return console.error(`Error al actualizar restaurante ${e}:`,a),{success:!1,error:a.message||"Error al actualizar restaurante"}}}async function c(e){try{const r=localStorage.getItem("token");r&&t["default"].setToken(r);const a=await t["default"].post(`/restaurantes/${e}/regenerate-link`);if(a&&a.success)return{success:!0,enlace_compartido:a.enlace_compartido,message:a.message||"Enlace regenerado correctamente"};throw new Error(a.message||"Error al regenerar enlace")}catch(r){return console.error(`Error al regenerar enlace para restaurante ${e}:`,r),{success:!1,error:r.message||"Error al regenerar enlace"}}}async function u(e,r){try{const a=localStorage.getItem("token");a&&t["default"].setToken(a);const s=await t["default"].post(`/restaurantes/${e}/asignar-usuario/${r}`);if(s&&s.success)return{success:!0,message:s.message||"Usuario asignado correctamente"};throw new Error(s.message||"Error al asignar usuario")}catch(a){return console.error(`Error al asignar usuario ${r} a restaurante ${e}:`,a),{success:!1,error:a.message||"Error al asignar usuario"}}}async function i(){try{const e=await s();return e.success&&e.restaurantes.length>0?{success:!0,restaurante:e.restaurantes[0]}:{success:!1,error:"No se encontró ningún restaurante asociado al usuario",restaurante:null}}catch(e){return console.error("Error al obtener restaurante del usuario:",e),{success:!1,error:e.message||"Error al obtener restaurante del usuario",restaurante:null}}}r.Ay={getRestaurantes:s,getRestaurante:n,createRestaurante:o,updateRestaurante:l,regenerateLink:c,assignUserToRestaurant:u,getCurrentUserRestaurant:i}}}]);
//# sourceMappingURL=admin-restaurantes.76a07f44.js.map