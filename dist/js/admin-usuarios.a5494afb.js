"use strict";(self["webpackChunkwebsap"]=self["webpackChunkwebsap"]||[]).push([[654],{2639:function(e,r,a){a.d(r,{AY:function(){return l},BL:function(){return u},XR:function(){return n},sl:function(){return s}});var t=a(133);async function s(){try{const e=localStorage.getItem("token");e&&t["default"].setToken(e);const r=await t["default"].get("/restaurantes");if(r&&r.success)return{success:!0,restaurantes:r.restaurantes||[]};throw new Error(r.message||"Error al obtener restaurantes")}catch(e){return console.error("Error al obtener restaurantes:",e),{success:!1,error:e.message||"Error al obtener restaurantes",restaurantes:[]}}}async function o(e){try{const r=localStorage.getItem("token");r&&t["default"].setToken(r);const a=await t["default"].get(`/restaurantes/${e}`);if(a&&a.success)return{success:!0,restaurante:a.restaurante};throw new Error(a.message||"Error al obtener restaurante")}catch(r){return console.error(`Error al obtener restaurante ${e}:`,r),{success:!1,error:r.message||"Error al obtener restaurante"}}}async function n(e){try{const r=localStorage.getItem("token");r&&t["default"].setToken(r);const a=await t["default"].post("/restaurantes",e);if(a&&a.success)return{success:!0,restaurante:a.restaurante,message:a.message||"Restaurante creado correctamente"};throw new Error(a.message||"Error al crear restaurante")}catch(r){return console.error("Error al crear restaurante:",r),{success:!1,error:r.message||"Error al crear restaurante"}}}async function l(e,r){try{const a=localStorage.getItem("token");a&&t["default"].setToken(a);const s=await t["default"].put(`/restaurantes/${e}`,r);if(s&&s.success)return{success:!0,restaurante:s.restaurante,message:s.message||"Restaurante actualizado correctamente"};throw new Error(s.message||"Error al actualizar restaurante")}catch(a){return console.error(`Error al actualizar restaurante ${e}:`,a),{success:!1,error:a.message||"Error al actualizar restaurante"}}}async function u(e){try{const r=localStorage.getItem("token");r&&t["default"].setToken(r);const a=await t["default"].post(`/restaurantes/${e}/regenerate-link`);if(a&&a.success)return{success:!0,enlace_compartido:a.enlace_compartido,message:a.message||"Enlace regenerado correctamente"};throw new Error(a.message||"Error al regenerar enlace")}catch(r){return console.error(`Error al regenerar enlace para restaurante ${e}:`,r),{success:!1,error:r.message||"Error al regenerar enlace"}}}async function i(e,r){try{const a=localStorage.getItem("token");a&&t["default"].setToken(a);const s=await t["default"].post(`/restaurantes/${e}/asignar-usuario/${r}`);if(s&&s.success)return{success:!0,message:s.message||"Usuario asignado correctamente"};throw new Error(s.message||"Error al asignar usuario")}catch(a){return console.error(`Error al asignar usuario ${r} a restaurante ${e}:`,a),{success:!1,error:a.message||"Error al asignar usuario"}}}async function c(){try{const e=await s();return e.success&&e.restaurantes.length>0?{success:!0,restaurante:e.restaurantes[0]}:{success:!1,error:"No se encontró ningún restaurante asociado al usuario",restaurante:null}}catch(e){return console.error("Error al obtener restaurante del usuario:",e),{success:!1,error:e.message||"Error al obtener restaurante del usuario",restaurante:null}}}r.Ay={getRestaurantes:s,getRestaurante:o,createRestaurante:n,updateRestaurante:l,regenerateLink:u,assignUserToRestaurant:i,getCurrentUserRestaurant:c}},2995:function(e,r,a){a.r(r),a.d(r,{default:function(){return oe}});var t=a(6768),s=a(4232),o=a(5130);const n={class:"admin-usuarios"},l={class:"card"},u={class:"card-header"},i={class:"actions"},c={class:"card-body"},d={key:0,class:"text-center my-5"},m={key:1,class:"alert alert-danger"},k={key:2},b={class:"table-responsive"},g={class:"table table-striped table-hover"},f={class:"btn-group"},p=["onClick"],v=["onClick"],h=["onClick"],L={class:"modal",id:"usuarioModal"},y={class:"modal-content"},E={class:"modal-header"},U={class:"modal-title",id:"usuarioModalLabel"},w={class:"modal-body"},C={class:"mb-3"},$={class:"mb-3"},_={class:"mb-3"},R={class:"mb-3"},M=["value"],A={class:"mb-3"},I=["value"],S={key:0,class:"mb-3"},X=["required"],N={class:"mb-3 form-check"},D={class:"d-flex justify-content-end"},B=["disabled"],T={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},z={class:"modal",id:"deleteModal"},q={class:"modal-content"},V={class:"modal-header"},x={class:"modal-body"},J={class:"modal-footer"},W=["disabled"],P={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"};function F(e,r,a,F,K,Q){return(0,t.uX)(),(0,t.CE)("div",n,[(0,t.Lk)("div",l,[(0,t.Lk)("div",u,[r[15]||(r[15]=(0,t.Lk)("h3",null,"Gestión de Usuarios",-1)),(0,t.Lk)("div",i,[(0,t.Lk)("button",{class:"btn btn-primary",onClick:r[0]||(r[0]=(...e)=>Q.showCreateModal&&Q.showCreateModal(...e))},r[14]||(r[14]=[(0,t.Lk)("i",{class:"fas fa-plus"},null,-1),(0,t.eW)(" Nuevo Usuario ")]))])]),(0,t.Lk)("div",c,[K.loading?((0,t.uX)(),(0,t.CE)("div",d,r[16]||(r[16]=[(0,t.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,t.Lk)("span",{class:"visually-hidden"},"Cargando...")],-1),(0,t.Lk)("p",{class:"mt-2"},"Cargando usuarios...",-1)]))):K.error?((0,t.uX)(),(0,t.CE)("div",m,(0,s.v_)(K.error),1)):((0,t.uX)(),(0,t.CE)("div",k,[(0,t.Lk)("div",b,[(0,t.Lk)("table",g,[r[19]||(r[19]=(0,t.Lk)("thead",null,[(0,t.Lk)("tr",null,[(0,t.Lk)("th",null,"Nombre"),(0,t.Lk)("th",null,"Email"),(0,t.Lk)("th",null,"Teléfono"),(0,t.Lk)("th",null,"Rol"),(0,t.Lk)("th",null,"Restaurante"),(0,t.Lk)("th",null,"Estado"),(0,t.Lk)("th",null,"Acciones")])],-1)),(0,t.Lk)("tbody",null,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(K.usuarios,(e=>((0,t.uX)(),(0,t.CE)("tr",{key:e.id},[(0,t.Lk)("td",null,(0,s.v_)(e.nombre),1),(0,t.Lk)("td",null,(0,s.v_)(e.email),1),(0,t.Lk)("td",null,(0,s.v_)(e.telefono||"No disponible"),1),(0,t.Lk)("td",null,(0,s.v_)(Q.getRolName(e)),1),(0,t.Lk)("td",null,(0,s.v_)(Q.getRestauranteName(e)),1),(0,t.Lk)("td",null,[(0,t.Lk)("span",{class:(0,s.C4)(e.activo?"badge bg-success":"badge bg-danger")},(0,s.v_)(e.activo?"Activo":"Inactivo"),3)]),(0,t.Lk)("td",null,[(0,t.Lk)("div",f,[(0,t.Lk)("button",{class:"btn btn-sm btn-info",onClick:r=>Q.editUsuario(e)},r[17]||(r[17]=[(0,t.Lk)("i",{class:"fas fa-edit"},null,-1)]),8,p),(0,t.Lk)("button",{class:(0,s.C4)(["btn btn-sm",e.activo?"btn-warning":"btn-success"]),onClick:r=>Q.toggleStatus(e)},[(0,t.Lk)("i",{class:(0,s.C4)(e.activo?"fas fa-ban":"fas fa-check")},null,2)],10,v),(0,t.Lk)("button",{class:"btn btn-sm btn-danger",onClick:r=>Q.deleteUsuario(e)},r[18]||(r[18]=[(0,t.Lk)("i",{class:"fas fa-trash"},null,-1)]),8,h)])])])))),128))])])])]))])]),(0,t.Lk)("div",L,[(0,t.Lk)("div",y,[(0,t.Lk)("div",E,[(0,t.Lk)("h5",U,(0,s.v_)(K.isEditing?"Editar Usuario":"Nuevo Usuario"),1),(0,t.Lk)("button",{type:"button",class:"btn-close",onClick:r[1]||(r[1]=e=>Q.closeModal("usuarioModal"))})]),(0,t.Lk)("div",w,[(0,t.Lk)("form",{onSubmit:r[10]||(r[10]=(0,o.D$)(((...e)=>Q.saveUsuario&&Q.saveUsuario(...e)),["prevent"]))},[(0,t.Lk)("div",C,[r[20]||(r[20]=(0,t.Lk)("label",{for:"nombre",class:"form-label"},"Nombre",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",class:"form-control",id:"nombre","onUpdate:modelValue":r[2]||(r[2]=e=>K.currentUsuario.nombre=e),required:""},null,512),[[o.Jo,K.currentUsuario.nombre]])]),(0,t.Lk)("div",$,[r[21]||(r[21]=(0,t.Lk)("label",{for:"email",class:"form-label"},"Email",-1)),(0,t.bo)((0,t.Lk)("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":r[3]||(r[3]=e=>K.currentUsuario.email=e),required:""},null,512),[[o.Jo,K.currentUsuario.email]])]),(0,t.Lk)("div",_,[r[22]||(r[22]=(0,t.Lk)("label",{for:"telefono",class:"form-label"},"Teléfono",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",class:"form-control",id:"telefono","onUpdate:modelValue":r[4]||(r[4]=e=>K.currentUsuario.telefono=e)},null,512),[[o.Jo,K.currentUsuario.telefono]])]),(0,t.Lk)("div",R,[r[24]||(r[24]=(0,t.Lk)("label",{for:"rol",class:"form-label"},"Rol",-1)),(0,t.bo)((0,t.Lk)("select",{class:"form-select",id:"rol","onUpdate:modelValue":r[5]||(r[5]=e=>K.currentUsuario.rol=e),required:""},[r[23]||(r[23]=(0,t.Lk)("option",{value:""},"Seleccione un rol",-1)),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(K.roles,(e=>((0,t.uX)(),(0,t.CE)("option",{key:e.id,value:e.nombre},(0,s.v_)(e.nombre),9,M)))),128))],512),[[o.u1,K.currentUsuario.rol]])]),(0,t.Lk)("div",A,[r[26]||(r[26]=(0,t.Lk)("label",{for:"restaurante",class:"form-label"},"Restaurante",-1)),(0,t.bo)((0,t.Lk)("select",{class:"form-select",id:"restaurante","onUpdate:modelValue":r[6]||(r[6]=e=>K.currentUsuario.restaurante_id=e),required:""},[r[25]||(r[25]=(0,t.Lk)("option",{value:""},"Seleccione un restaurante",-1)),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(K.restaurantes,(e=>((0,t.uX)(),(0,t.CE)("option",{key:e.id,value:e.id},(0,s.v_)(e.nombre),9,I)))),128))],512),[[o.u1,K.currentUsuario.restaurante_id]])]),K.isEditing?(0,t.Q3)("",!0):((0,t.uX)(),(0,t.CE)("div",S,[r[27]||(r[27]=(0,t.Lk)("label",{for:"password",class:"form-label"},"Contraseña",-1)),(0,t.bo)((0,t.Lk)("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":r[7]||(r[7]=e=>K.currentUsuario.password=e),required:!K.isEditing},null,8,X),[[o.Jo,K.currentUsuario.password]])])),(0,t.Lk)("div",N,[(0,t.bo)((0,t.Lk)("input",{type:"checkbox",class:"form-check-input",id:"activo","onUpdate:modelValue":r[8]||(r[8]=e=>K.currentUsuario.activo=e)},null,512),[[o.lH,K.currentUsuario.activo]]),r[28]||(r[28]=(0,t.Lk)("label",{class:"form-check-label",for:"activo"},"Usuario activo",-1))]),(0,t.Lk)("div",D,[(0,t.Lk)("button",{type:"button",class:"btn btn-secondary me-2",onClick:r[9]||(r[9]=e=>Q.closeModal("usuarioModal"))},"Cancelar"),(0,t.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:K.saving},[K.saving?((0,t.uX)(),(0,t.CE)("span",T)):(0,t.Q3)("",!0),(0,t.eW)(" "+(0,s.v_)(K.isEditing?"Actualizar":"Crear"),1)],8,B)])],32)])])]),(0,t.Lk)("div",z,[(0,t.Lk)("div",q,[(0,t.Lk)("div",V,[r[29]||(r[29]=(0,t.Lk)("h5",{class:"modal-title",id:"deleteModalLabel"},"Confirmar eliminación",-1)),(0,t.Lk)("button",{type:"button",class:"btn-close",onClick:r[11]||(r[11]=e=>Q.closeModal("deleteModal"))})]),(0,t.Lk)("div",x,[r[30]||(r[30]=(0,t.eW)(" ¿Está seguro que desea eliminar al usuario ")),(0,t.Lk)("strong",null,(0,s.v_)(K.currentUsuario.nombre),1),r[31]||(r[31]=(0,t.eW)("? Esta acción no se puede deshacer. "))]),(0,t.Lk)("div",J,[(0,t.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:r[12]||(r[12]=e=>Q.closeModal("deleteModal"))},"Cancelar"),(0,t.Lk)("button",{type:"button",class:"btn btn-danger",onClick:r[13]||(r[13]=(...e)=>Q.confirmDelete&&Q.confirmDelete(...e)),disabled:K.deleting},[K.deleting?((0,t.uX)(),(0,t.CE)("span",P)):(0,t.Q3)("",!0),r[32]||(r[32]=(0,t.eW)(" Eliminar "))],8,W)])])])])}a(8111),a(116);var K=a(4373);function Q(){const e=JSON.parse(localStorage.getItem("user"));return e&&e.token?{Authorization:"Bearer "+e.token}:{}}const O="https://websapmenu.onrender.com/api";class j{getUsuarios(){return K.A.get(`${O}/usuarios`,{headers:Q()})}getUsuario(e){return K.A.get(`${O}/usuarios/${e}`,{headers:Q()})}createUsuario(e){return K.A.post(`${O}/usuarios`,e,{headers:Q()})}updateUsuario(e,r){return K.A.put(`${O}/usuarios/${e}`,r,{headers:Q()})}deleteUsuario(e){return K.A.delete(`${O}/usuarios/${e}`,{headers:Q()})}}var G=new j;const H="https://websapmenu.onrender.com/api";function Y(){const e=JSON.parse(localStorage.getItem("user"));return e&&e.token?{Authorization:"Bearer "+e.token}:{}}class Z{getRoles(){return K.A.get(`${H}/roles`,{headers:Y()})}getRol(e){return K.A.get(`${H}/roles/${e}`,{headers:Y()})}createRol(e){return K.A.post(`${H}/roles`,e,{headers:Y()})}updateRol(e,r){return K.A.put(`${H}/roles/${e}`,r,{headers:Y()})}deleteRol(e){return K.A.delete(`${H}/roles/${e}`,{headers:Y()})}}var ee=new Z,re=a(2639),ae={name:"AdminUsuarios",data(){return{usuarios:[],roles:[],restaurantes:[],currentUsuario:{nombre:"",email:"",telefono:"",rol:"",restaurante_id:"",password:"",activo:!0},isEditing:!1,loading:!0,saving:!1,deleting:!1,error:null}},async mounted(){await this.loadData()},methods:{async loadData(){try{this.loading=!0,this.error=null;const e=await G.getUsuarios();this.usuarios=e.data;const r=await ee.getRoles();this.roles=r.data;const a=await re.Ay.getRestaurantes();this.restaurantes=a.data}catch(e){console.error("Error al cargar datos:",e),this.error="Error al cargar los datos. Por favor, inténtelo de nuevo."}finally{this.loading=!1}},showCreateModal(){this.isEditing=!1,this.currentUsuario={nombre:"",email:"",telefono:"",rol:"",restaurante_id:"",password:"",activo:!0},document.getElementById("usuarioModal").style.display="block"},editUsuario(e){this.isEditing=!0,this.currentUsuario={...e},document.getElementById("usuarioModal").style.display="block"},async saveUsuario(){try{this.saving=!0,this.isEditing?(await G.updateUsuario(this.currentUsuario.id,this.currentUsuario),alert("Usuario actualizado correctamente")):(await G.createUsuario(this.currentUsuario),alert("Usuario creado correctamente")),await this.loadData(),document.getElementById("usuarioModal").style.display="none"}catch(e){console.error("Error al guardar usuario:",e),alert("Error al guardar el usuario. Por favor, inténtelo de nuevo.")}finally{this.saving=!1}},deleteUsuario(e){this.currentUsuario={...e},document.getElementById("deleteModal").style.display="block"},async confirmDelete(){try{this.deleting=!0,await G.deleteUsuario(this.currentUsuario.id),alert("Usuario eliminado correctamente"),await this.loadData(),document.getElementById("deleteModal").style.display="none"}catch(e){console.error("Error al eliminar usuario:",e),alert("Error al eliminar el usuario. Por favor, inténtelo de nuevo.")}finally{this.deleting=!1}},async toggleStatus(e){try{const r={...e,activo:!e.activo};await G.updateUsuario(e.id,r),alert(`Usuario ${r.activo?"activado":"desactivado"} correctamente`),await this.loadData()}catch(r){console.error("Error al cambiar estado del usuario:",r),alert("Error al cambiar el estado del usuario. Por favor, inténtelo de nuevo.")}},getRolName(e){return e.rol?e.rol:e.usuario_roles&&e.usuario_roles.length>0?e.usuario_roles[0].rol:"Sin rol"},getRestauranteName(e){if(!e.restaurante_id)return"Sin asignar";const r=this.restaurantes.find((r=>r.id===e.restaurante_id));return r?r.nombre:"Desconocido"},closeModal(e){document.getElementById(e).style.display="none"}}},te=a(1241);const se=(0,te.A)(ae,[["render",F],["__scopeId","data-v-2aea98b8"]]);var oe=se}}]);
//# sourceMappingURL=admin-usuarios.a5494afb.js.map