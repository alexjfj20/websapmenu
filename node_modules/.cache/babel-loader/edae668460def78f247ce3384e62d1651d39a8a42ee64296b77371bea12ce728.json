{"ast":null,"code":"import { ref } from 'vue';\nexport default {\n  name: 'DirectDeleteButton',\n  props: {\n    platoId: {\n      type: String,\n      required: true\n    },\n    platoName: {\n      type: String,\n      default: 'este plato'\n    }\n  },\n  emits: ['deleted', 'error'],\n  setup(props, {\n    emit\n  }) {\n    const isDeleting = ref(false);\n    const showConfirmation = ref(false);\n    const deleteStatus = ref('');\n    const executeDelete = async () => {\n      isDeleting.value = true;\n      deleteStatus.value = 'Iniciando eliminación...';\n      try {\n        // Usar el endpoint de eliminación directa mejorado\n        const response = await fetch(`http://localhost:3000/direct-delete?id=${encodeURIComponent(props.platoId)}`, {\n          method: 'GET',\n          headers: {\n            'Cache-Control': 'no-cache'\n          }\n        });\n        console.log(`Respuesta del servidor: Status ${response.status}`);\n        if (response.ok) {\n          const result = await response.json();\n          console.log('Respuesta completa:', result);\n          if (result.success) {\n            deleteStatus.value = 'Plato eliminado con éxito';\n            emit('deleted', props.platoId);\n            showConfirmation.value = false;\n\n            // También eliminar de IndexedDB para mantener todo sincronizado\n            try {\n              const db = await window.indexedDB.open('websap', 3);\n              db.onsuccess = function (event) {\n                const database = event.target.result;\n                const transaction = database.transaction(['platos'], 'readwrite');\n                const store = transaction.objectStore('platos');\n                store.delete(props.platoId);\n                transaction.oncomplete = function () {\n                  console.log(`Plato ${props.platoId} también eliminado de IndexedDB`);\n                };\n              };\n            } catch (localDbError) {\n              console.warn('No se pudo eliminar de IndexedDB, pero se eliminó de MySQL:', localDbError);\n            }\n            alert(`El plato \"${props.platoName}\" ha sido eliminado correctamente de la base de datos MySQL.`);\n          } else {\n            deleteStatus.value = `Error: ${result.message}`;\n            emit('error', {\n              id: props.platoId,\n              message: result.message\n            });\n            alert(`Error al eliminar el plato: ${result.message}`);\n          }\n        } else {\n          const errorText = await response.text();\n          deleteStatus.value = `Error: ${response.status} - ${errorText}`;\n          emit('error', {\n            id: props.platoId,\n            status: response.status,\n            message: errorText\n          });\n          alert(`Error al eliminar el plato. Status: ${response.status}\\n${errorText}`);\n        }\n      } catch (error) {\n        deleteStatus.value = `Error: ${error.message}`;\n        emit('error', {\n          id: props.platoId,\n          message: error.message\n        });\n        alert(`Error al eliminar el plato: ${error.message}`);\n      } finally {\n        isDeleting.value = false;\n      }\n    };\n    return {\n      isDeleting,\n      showConfirmation,\n      deleteStatus,\n      executeDelete\n    };\n  }\n};","map":{"version":3,"names":["ref","name","props","platoId","type","String","required","platoName","default","emits","setup","emit","isDeleting","showConfirmation","deleteStatus","executeDelete","value","response","fetch","encodeURIComponent","method","headers","console","log","status","ok","result","json","success","db","window","indexedDB","open","onsuccess","event","database","target","transaction","store","objectStore","delete","oncomplete","localDbError","warn","alert","message","id","errorText","text","error"],"sources":["F:\\Driver google\\VUE.JS-2\\VUE-JS\\websap\\src\\components\\DirectDeleteButton.vue"],"sourcesContent":["// src/components/DirectDeleteButton.vue\n\n<template>\n  <div class=\"direct-delete-container\">\n    <button \n      @click=\"showConfirmation = true\" \n      class=\"direct-delete-button\"\n      :disabled=\"isDeleting\"\n    >\n      {{ isDeleting ? 'Eliminando...' : 'Eliminar Directamente' }}\n    </button>\n    \n    <div v-if=\"showConfirmation\" class=\"confirmation-dialog\">\n      <div class=\"confirmation-content\">\n        <h3>Confirmar Eliminación</h3>\n        <p>¿Estás seguro de que deseas eliminar el plato <strong>{{ platoName }}</strong>?</p>\n        <p>Esta acción eliminará el plato directamente de la base de datos MySQL y no se puede deshacer.</p>\n        \n        <div class=\"confirmation-actions\">\n          <button @click=\"showConfirmation = false\" class=\"cancel-button\">Cancelar</button>\n          <button @click=\"executeDelete\" class=\"confirm-button\" :disabled=\"isDeleting\">\n            {{ isDeleting ? 'Eliminando...' : 'Confirmar Eliminación' }}\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref } from 'vue';\n\nexport default {\n  name: 'DirectDeleteButton',\n  \n  props: {\n    platoId: {\n      type: String,\n      required: true\n    },\n    platoName: {\n      type: String,\n      default: 'este plato'\n    }\n  },\n  \n  emits: ['deleted', 'error'],\n  \n  setup(props, { emit }) {\n    const isDeleting = ref(false);\n    const showConfirmation = ref(false);\n    const deleteStatus = ref('');\n    \n    const executeDelete = async () => {\n      isDeleting.value = true;\n      deleteStatus.value = 'Iniciando eliminación...';\n      \n      try {\n        // Usar el endpoint de eliminación directa mejorado\n        const response = await fetch(`http://localhost:3000/direct-delete?id=${encodeURIComponent(props.platoId)}`, {\n          method: 'GET',\n          headers: {\n            'Cache-Control': 'no-cache'\n          }\n        });\n        \n        console.log(`Respuesta del servidor: Status ${response.status}`);\n        \n        if (response.ok) {\n          const result = await response.json();\n          console.log('Respuesta completa:', result);\n          \n          if (result.success) {\n            deleteStatus.value = 'Plato eliminado con éxito';\n            emit('deleted', props.platoId);\n            showConfirmation.value = false;\n            \n            // También eliminar de IndexedDB para mantener todo sincronizado\n            try {\n              const db = await window.indexedDB.open('websap', 3);\n              db.onsuccess = function(event) {\n                const database = event.target.result;\n                const transaction = database.transaction(['platos'], 'readwrite');\n                const store = transaction.objectStore('platos');\n                store.delete(props.platoId);\n                \n                transaction.oncomplete = function() {\n                  console.log(`Plato ${props.platoId} también eliminado de IndexedDB`);\n                };\n              };\n            } catch (localDbError) {\n              console.warn('No se pudo eliminar de IndexedDB, pero se eliminó de MySQL:', localDbError);\n            }\n            \n            alert(`El plato \"${props.platoName}\" ha sido eliminado correctamente de la base de datos MySQL.`);\n          } else {\n            deleteStatus.value = `Error: ${result.message}`;\n            emit('error', { id: props.platoId, message: result.message });\n            alert(`Error al eliminar el plato: ${result.message}`);\n          }\n        } else {\n          const errorText = await response.text();\n          deleteStatus.value = `Error: ${response.status} - ${errorText}`;\n          emit('error', { id: props.platoId, status: response.status, message: errorText });\n          alert(`Error al eliminar el plato. Status: ${response.status}\\n${errorText}`);\n        }\n      } catch (error) {\n        deleteStatus.value = `Error: ${error.message}`;\n        emit('error', { id: props.platoId, message: error.message });\n        alert(`Error al eliminar el plato: ${error.message}`);\n      } finally {\n        isDeleting.value = false;\n      }\n    };\n    \n    return {\n      isDeleting,\n      showConfirmation,\n      deleteStatus,\n      executeDelete\n    };\n  }\n};\n</script>\n\n<style scoped>\n.direct-delete-button {\n  background-color: #dc3545;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  padding: 8px 16px;\n  cursor: pointer;\n  font-weight: bold;\n  transition: background-color 0.3s;\n  margin-top: 10px;\n  width: 100%;\n}\n\n.direct-delete-button:hover {\n  background-color: #c82333;\n}\n\n.direct-delete-button:disabled {\n  background-color: #6c757d;\n  cursor: not-allowed;\n}\n\n.confirmation-dialog {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(0, 0, 0, 0.5);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  z-index: 1000;\n}\n\n.confirmation-content {\n  background-color: white;\n  padding: 20px;\n  border-radius: 8px;\n  max-width: 400px;\n  width: 90%;\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n}\n\n.confirmation-content h3 {\n  margin-top: 0;\n  color: #dc3545;\n}\n\n.confirmation-actions {\n  display: flex;\n  justify-content: flex-end;\n  margin-top: 20px;\n  gap: 10px;\n}\n\n.cancel-button {\n  background-color: #6c757d;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  padding: 8px 16px;\n  cursor: pointer;\n}\n\n.confirm-button {\n  background-color: #dc3545;\n  color: white;\n  border: none;\n  border-radius: 4px;\n  padding: 8px 16px;\n  cursor: pointer;\n  font-weight: bold;\n}\n\n.confirm-button:disabled {\n  background-color: #6c757d;\n  cursor: not-allowed;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}